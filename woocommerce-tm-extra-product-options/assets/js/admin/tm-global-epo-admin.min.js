!function(r,c,w){"use strict";var e,a,m,u,p,f,y,n,_=r.wp,l=r.TMEPOADMINJS,x=r.TMEPOGLOBALADMINJS,h=r.toastr,b=r._,i=r.plupload,k=!1,g={tc_builder_elements:_.template("tc-builder-elements"),tc_builder_section:_.template("tc-builder-section")},v=r.JSON,O="data:image/gif;base64,R0lGODlhAQABAAAAACwAAAAAAQABAAA=";function A(t){var i=[];return Object.keys(t).forEach(function(e){Object.prototype.hasOwnProperty.call(t,e)&&(i[i.length]=t[e])}),i}w.tmEPOAdmin={addEventsDone:0,variationsCheckForChanges:0,elementLogicObject:{},sectionLogicObject:{},elementShippingLogicObject:{},logicOperators:{is:x.i18n_is,isnot:x.i18n_is_not,isempty:x.i18n_is_empty,isnotempty:x.i18n_is_not_empty,startswith:x.i18n_starts_with,endswith:x.i18n_ends_with,greaterthan:x.i18n_greater_than,lessthan:x.i18n_less_than,greaterthanequal:x.i18n_greater_than_equal,lessthanequal:x.i18n_less_than_equal},builderItemsSortableObj:{start:{},end:{}},builderSectionsSortableObj:{start:{},end:{}},builderSize:{},isElementDragged:!1,variationSection:!1,variationSectionIndex:!1,variationFieldIndex:!1,checkboxStates:{},canTakeLogic:["product","color","range","radiobuttons","checkboxes","selectbox","selectboxmultiple","textfield","textarea","variations"],addSortables:function(){w.tmEPOAdmin.is_original&&(w(".builder-layout").sortablejs({handle:".move",draggable:".builder-wrapper:not(.tma-nomove)",onStart:function(e){e=w(e.item).closest(".builder-wrapper").index();w.tmEPOAdmin.builderSectionsSortableObj.start.section=e},onEnd:function(e){e=w(e.item).closest(".builder-wrapper").index();w.tmEPOAdmin.builderSectionsSortableObj.end.section=e,y.splice(e,0,y.splice(w.tmEPOAdmin.builderSectionsSortableObj.start.section,1)[0]),w.tmEPOAdmin.builder_reorder_multiple(),w.tmEPOAdmin.builderSectionsSortableObj={start:{},end:{}}},filter:".tma-nomove",forceFallback:!0,fallbackClass:"sortable-fallback"}),w.tmEPOAdmin.builder_items_sortable(w(".builder-wrapper .bitem-wrapper")))},getBuilder:function(){return y},getBuilderJSON:function(){return v.stringify(y)},setBuilder:function(e){y=w.epoAPI.util.deepCopyArray(w.epoAPI.util.parseJSON(e))},addEvents:function(){var e,l,o,d,s,t=w(".tagchecklist");1!==w.tmEPOAdmin.addEventsDone&&(w.tmEPOAdmin.addSortables(),e=w("#builder_import_file"),(e=new i.Uploader({url:x.import_url,browse_button:e[0],file_data_name:"builder_import_file",multi_selection:!1})).init(),e.bind("FilesAdded",function(i){function e(e,t){e={action:"import",import_override:e,post_id:x.post_id,security:x.import_nonce,is_original_post:x.is_original_post},o&&(e.tm_uploadmeta=t),w(".flasho").find(".tm-inner, .details-override, .details-append").remove(),n.appendTo("#tc-floatbox-content"),w(".tc-progress-info-content").html(x.i18n_importing),i.setOption("multipart_params",e),i.start(),w(".flasho").addClass("tc-color-notice")}var t=w.tmEPOAdmin.builder_floatbox_template_import({id:"tc-floatbox-content",html:'<div class="tm-inner">'+x.i18n_confirm_import_message+"</div>",title:x.i18n_import_title}),n=w('<div class="tc-progress-bar tc-notice"><span class="tc-percent"></span></div><div class="tc-progress-info"><span class="tc-progress-info-content"></span></div>'),a=w('<button type="button" class="tc tc-button details-override">'+x.i18n_overwrite_existing_elements+'</button><button type="button" class="tc tc-button details-append">'+x.i18n_append_new_elements+"</button>");l=w.tcFloatBox({closefadeouttime:0,animateOut:"",ismodal:!0,width:"600px",classname:"flasho tc-wrapper",data:t}),a.appendTo(".flasho .footer .inner"),y=w.tmEPOAdmin.checkSections(y),o=w.tmEPOAdmin.tm_escape(v.stringify(w.tmEPOAdmin.prepareForJson(w.tmEPOAdmin.tcSerializeJsOptionsObject(y)))),x.is_original_post?(w(".details-override").on("click",function(){e(1)}),w(".details-append").on("click",function(){e(0,o)})):e(1,o)}),e.bind("FileUploaded",function(e,t,i){var n=w.epoAPI.util.parseJSON(i.response);n&&void 0!==n.result&&n.message&&w(".tc-progress-info-content").html(n.message),n&&n.error&&n.message&&w(".tc-progress-info-content").html(n.message),n&&void 0!==n.result&&1===w.epoAPI.math.toFloat(n.result)?(w(".tc-progress-bar").removeClass("tc-notice").addClass("tc-success"),w(".tc-progress-info-content").removeClass("tc-color-error").addClass("tc-color-success"),w(".flasho").removeClass("tc-color-notice tc-color-error").addClass("tc-color-success"),w(".floatbox-cancel").remove(),w(".tc-progress-info-content").html(x.i18n_saving),w(r).off("beforeunload.edit-post"),n.options&&(Array.isArray(n.jsobject)?(w(".builder-layout").html(n.options),y=n.jsobject,w.tmEPOAdmin.setGlobalVariationObject("initialitize_on_after"),h.success(n.message,x.i18n_epo)):h.error(x.i18n_invalid_request,x.i18n_epo)),l.destroy()):(w(".tc-progress-bar").removeClass("tc-notice").addClass("tc-error"),w(".tc-progress-info-content").removeClass("tc-color-success").addClass("tc-color-error"),w(".flasho").removeClass("tc-color-notice tc-color-success").addClass("tc-color-error"),!n&&i&&i.response&&w(".tc-progress-info-content").addClass("tc-normal-font").html(i.response),h.error(x.i18n_invalid_request,x.i18n_epo))}),e.bind("UploadProgress",function(e,t){t=parseInt(t.percent,10);w(".tc-progress-bar").css("width",t+"%"),w(".tc-percent").html(t+"%")}),e.bind("Error",function(e,t){t&&t.message&&w(".tc-progress-info-content").removeClass("tc-color-success").addClass("tc-color-error").html("\nError #"+t.code+": "+t.message),w(".tc-progress-bar").removeClass("tc-notice").addClass("tc-error"),w(".flasho").removeClass("tc-color-notice tc-color-success").addClass("tc-color-error")}),e.bind("UploadComplete",function(){w("body").removeClass("overflow")}),w(c).on("click.cpf","#builder_export",function(e){var t=w(this);e.preventDefault(),t.data("doing_export")||(t.data("doing_export",1),t.find(".tcfa").removeClass("tcfa-file-export").addClass("tcfa-spin tcfa-spinner"),y=w.tmEPOAdmin.checkSections(y),e=w.tmEPOAdmin.prepareForJson(w.tmEPOAdmin.tcSerializeJsOptionsObject(y)),e={action:"tm_export",metaserialized:v.stringify(e),is_original_post:x.is_original_post,security:x.export_nonce},w.post(x.ajax_url,e,function(e){e&&e.result&&""!==e.result?r.location=e.result:e&&e.error&&e.message&&(e=w.tmEPOAdmin.builder_floatbox_template_import({id:"tc-floatbox-content",html:'<div class="tm-inner">'+e.message+"</div>",title:x.i18n_error_title}),w.tcFloatBox({closefadeouttime:0,animateOut:"",ismodal:!0,maxWidth:"400px",classname:"flasho tc-wrapper tm-error",data:e}))},"json").always(function(){t.data("doing_export",0),t.find(".tcfa").removeClass("tcfa-spin tcfa-spinner").addClass("tcfa-file-export")}))}),w(c).on("click.cpf","#builder_save",function(e){var t,i,n,a=w(this);a.data("doing_export")||(a.data("doing_export",1),a.find(".tcfa").removeClass("tcfa-save").addClass("tcfa-spin tcfa-spinner"),y=w.tmEPOAdmin.checkSections(y),t={action:"tm_save",tm_uploadmeta:w.tmEPOAdmin.tm_escape(v.stringify(w.tmEPOAdmin.prepareForJson(w.tmEPOAdmin.tcSerializeJsOptionsObject(y)))),post_id:x.post_id,security:x.save_nonce},w("#tmformfieldsbuilderwrap").addClass("disabled"),n=w.tmEPOAdmin.doConfirm({title:x.i18n_saving,template:"tc-floatbox-import",cancel:x.i18n_close},function(){i.abort()},this,[w(this)],!0),e.preventDefault(),i=w.ajax({url:x.ajax_url,type:"POST",data:t,dataType:"json",success:function(e){e&&e.result&&1===e.result?h.success(e.message,x.i18n_epo):h.error(e.message,x.i18n_epo)},error:function(e,t,i){"abort"!==t&&h.error(x.i18n_error_saving+"<p>"+i+"</p>",x.i18n_epo)}}).always(function(e){w("#tmformfieldsbuilderwrap").removeClass("disabled"),"-1"===e.responseText&&h.error(x.i18n_invalid_request,x.i18n_epo),a.data("doing_export",0),a.find(".tcfa").removeClass("tcfa-spin tcfa-spinner").addClass("tcfa-save"),n.destroy()}))}),w(c).on("click.cpf","#builder_import,.tc-add-import-csv",function(e){e.preventDefault(),w("#builder_import_file").trigger("click")}),w(c).on("click.cpf",".tc-add-import-wpml-lang",function(e){var t=w(this),i=w.tmEPOAdmin.builder_floatbox_template_import({id:"tc-floatbox-content",html:'<div class="tm-inner">'+x.i18n_confirm_template_import_original_message+"</div>",title:x.i18n_import_title}),n=w('<button type="button" class="tc tc-button details-override">'+x.i18n_overwrite_existing_element+"</button>");e.preventDefault(),l=w.tcFloatBox({closefadeouttime:0,animateOut:"",ismodal:!0,width:"600px",classname:"flasho tc-wrapper",data:i}),n.appendTo(".flasho .footer .inner"),w(".details-override").on("click",function(){l.destroy(),function(t){var e,i,n;t.data("doing_import")||(t.data("doing_import",1),t.find(".tcfa").removeClass("file-import").addClass("tcfa-spin tcfa-spinner"),y=w.tmEPOAdmin.checkSections(y),e={action:"tm_wpml_import_original_template",post_id:x.post_id,security:x.import_nonce},w("#tmformfieldsbuilderwrap").addClass("disabled"),n=w.tmEPOAdmin.doConfirm({title:x.i18n_saving,template:"tc-floatbox-import",cancel:x.i18n_close},function(){i.abort()},this,[w(this)],!0),i=w.ajax({url:x.ajax_url,type:"POST",data:e,dataType:"json",success:function(e){e&&e.result&&1===e.result&&e.options?Array.isArray(e.jsobject)?(w(".builder-layout").html(e.options),y=e.jsobject,w.tmEPOAdmin.setGlobalVariationObject("initialitize_on_after"),h.success(e.message,x.i18n_epo)):h.error(x.i18n_invalid_request,x.i18n_epo):h.error(e.message,x.i18n_epo)},error:function(e,t,i){"abort"!==t&&h.error(x.i18n_error_saving+"<p>"+i+"</p>",x.i18n_epo)}}).always(function(e){w("#tmformfieldsbuilderwrap").removeClass("disabled"),"-1"===e.responseText&&h.error(x.i18n_invalid_request,x.i18n_epo),t.data("doing_import",0),t.find(".tcfa").removeClass("tcfa-spin tcfa-spinner").addClass("file-import"),n.destroy()}))}(t)})}),w(c).on("click.cpf","#builder-fullsize",function(e){e.preventDefault(),w("body").addClass("overflow fullsize")}),w(c).on("click.cpf","#builder-fullsize-close",function(e){e.preventDefault(),w("body").removeClass("overflow fullsize")}),w(c).on("click.cpf",".builder-add-element",w.tmEPOAdmin.builder_add_element_onClick),w(c).on("click.cpf",".builder_add_section,.tc-add-section ",w.tmEPOAdmin.builder_add_section_onClick),w(c).on("click.cpf",".builder-add-section-and-element,.tc-add-element",w.tmEPOAdmin.builder_add_section_and_element_onClick),w(c).on("click.cpf",".builder_add_variation",w.tmEPOAdmin.builder_add_variation_onClick),w(c).on("click.cpf",".builder-wrapper .section-settings .edit",w.tmEPOAdmin.builder_section_item_onClick),w(c).on("click.cpf",".builder-wrapper .section-settings .clone",w.tmEPOAdmin.builder_section_clone_onClick),w(c).on("click.cpf",".builder-wrapper .section-settings .plus",w.tmEPOAdmin.builder_section_plus_onClick),w(c).on("click.cpf",".builder-wrapper .section-settings .minus",w.tmEPOAdmin.builder_section_minus_onClick),w(c).on("click.cpf",".builder-wrapper .btitle .delete:not(.builder-wrapper.tma-variations-wrap .btitle .delete)",w.tmEPOAdmin.builder_section_delete_onClick),w(c).on("click.cpf",".builder-wrapper .btitle .fold",w.tmEPOAdmin.builder_section_fold_onClick),w(c).on("click",".builder-wrapper.tma-variations-wrap .btitle .delete",w.tmEPOAdmin.builder_variation_delete_onClick),w(c).on("click.cpf",".bitem .bitem-settings .edit",w.tmEPOAdmin.builder_item_onClick),w(c).on("click.cpf",".bitem .bitem-settings .clone",w.tmEPOAdmin.builder_clone_onClick),w(c).on("click.cpf",".bitem .bitem-settings .change",w.tmEPOAdmin.builder_change_onClick),w(c).on("click.cpf",".bitem .bitem-settings .plus",w.tmEPOAdmin.builder_plus_onClick),w(c).on("click.cpf",".bitem .bitem-settings .minus",w.tmEPOAdmin.builder_minus_onClick),w(c).on("click",".bitem .delete",w.tmEPOAdmin.builder_delete_onClick),w(c).on("click",".edit-element .tm-element-uniqid",w.tmEPOAdmin.builder_uniqid_onClick),w(c).on("click.cpf",".builder-panel-add",w.tmEPOAdmin.builder_panel_add_onClick),w(c).on("click.cpf",".builder-panel-add-separator",w.tmEPOAdmin.builder_panel_add_separator_onClick),w(c).on("click.cpf",".builder-panel-mass-add",w.tmEPOAdmin.builder_panel_mass_add_onClick),w(c).on("click.cpf",".builder-panel-populate",w.tmEPOAdmin.builder_panel_populate_onClick),w(c).on("click.cpf",".builder-image-delete",w.tmEPOAdmin.builder_image_delete_onClick),w(c).on("click.cpf",".builder_panel_delete",w.tmEPOAdmin.builder_panel_delete_onClick),w(".builder_panel_delete").on("click.cpf",w.tmEPOAdmin.builder_panel_delete_onClick),w(c).on("click.cpf",".builder_panel_delete_all",w.tmEPOAdmin.builder_panel_delete_all_onClick),w(c).on("click.cpf",".builder_panel_up",function(){var e=w(this),t=e.closest(".options-wrap");t.prev().before(t),w.tmEPOAdmin.panelsReorder(e.closest(".panels_wrap")),w.tmEPOAdmin.paginattion_init("current")}),w(c).on("click.cpf",".builder_panel_down",function(){var e=w(this),t=e.closest(".options-wrap");t.next().after(t),w.tmEPOAdmin.panelsReorder(e.closest(".panels_wrap")),w.tmEPOAdmin.paginattion_init("current")}),w(c).on("keyup.cpf change.cpf",".tm_option_title",function(){w(this).closest(".options-wrap").find(".tm_option_value").val(w("<div/>").html(w(this).val()).text())}),w(c).on("change.cpf changechoice",".tc-option-enabled",function(){var e=w(this);e.is(":checked")?e.closest(".options-wrap").removeClass("choice-is-disabled"):e.closest(".options-wrap").addClass("choice-is-disabled")}),w(c).on("change.cpf changednmpbq",".tc-cell-dnmpbq .c",function(){var e=w(this),t=e.closest(".options-wrap").find(".tc-cell-fee");e.is(":checked")?(t.find(".c").prop("checked",!1),t.hide()):t.show()}),w(c).on("change.cpf changefee",".tc-cell-fee .c",function(){var e=w(this),t=e.closest(".options-wrap").find(".tc-cell-dnmpbq");e.is(":checked")?(t.find(".c").prop("checked",!1),t.hide()):t.show()}),w(c).on("click.cpf",".tc-element-setting-price, .tc-element-setting-sale-price, .tm_option_price, .tm_option_sale_price",function(){var e,s,a,i,n=w(this),t=n.is(".dynamic-product-price")||n.is(".change-product-weight"),l=n.is(".override-product-price")||n.is(".change-product-weight"),o=n.is(".tc-element-setting-price, .tc-element-setting-sale-price")?w(".tm-pricetype-selector"):n.closest(".options-wrap").find(".tm_option_price_type");"math"===o.val()&&(a=function(e){for(var t,i,n,a,l=[],o=["'",'"'],d=0;d<e.length;d++)if(t=e[d],o.includes(t)){for(i=t,n=d+1;n<e.length&&e[n]!==i;)n++;d=n}else if("["===t||"{"===t)l.push(t);else if(("]"===t||"}"===t)&&(!(a=l.pop())||"]"===t&&"["!==a||"}"===t&&"{"!==a))return!1;return 0===l.length},s=function(){var e,t=r.tcmexp,i=w(".tc-element-setting-edit-price").val(),n=!0;return t&&(e=i.replace(/\{[^}]+\}|\[[^\]]+\]/g,"(0)"),!1!==(n=t.parse(e))&&a(i)?w(".tc-element-setting-edit-price").removeClass("formula-error").addClass("formula-correct"):w(".tc-element-setting-edit-price").removeClass("formula-correct").addClass("formula-error")),n},o=n.val(),e=w.tmEPOAdmin.builder_floatbox_template({id:"tc-floatbox-content-pop",update:x.i18n_save,html:'<div class="tm-inner"><textarea class="tc-element-setting-edit-price"></textarea></div>',title:x.i18n_math_formula_popup_title},"tc-floatbox-edit"),w.tcFloatBox({closefadeouttime:0,animateOut:"",ismodal:!1,width:"50%",height:"80%",classname:"flasho tc-wrapper tc-math-popup",data:e,cancelClass:".floatbox-edit-cancel",cancelEvent:function(e){i.destroy(),e.destroy()},updateClass:".floatbox-edit-update",updateEvent:function(e){var t=w(".tc-element-setting-edit-price").val();s(),n.val(t),i.destroy(),e.destroy()},unique:!0}),e=w.tmEPOAdmin.builder_floatbox_template({update:"",html:'<div class="tm-inner"><div class="tc-price-variables"></div></div>',title:""},"tc-floatbox-edit"),i=w.tcFloatBox({classnameMain:"floatbox leger",leger:!0,closefadeouttime:0,animateOut:"",ismodal:!0,width:"30%",height:"80%",classname:"flasho tc-wrapper tc-math-popup-leger",data:e,cancelClass:".floatbox-edit-cancel",unique:!0,showoverlay:!1}),w(".tc-math-popup-leger .header, .tc-math-popup-leger .footer").remove(),w.tmEPOAdmin.populatePriceVariables(w(".tc-price-variables"),t,l),w(".tc-element-setting-edit-price").val(o),s(),w(".tc-var-field").on("click.cpf",function(e){var t=w(".tc-element-setting-edit-price"),i=t.val(),n=t[0],a=n.selectionStart,l=n.scrollTop,o=i.substring(0,a),i=i.substring(n.selectionEnd,i.length),d=w(this).attr("data-value");e.preventDefault(),t.val(o+d+i),a+=d.length,n.selectionStart=a,n.selectionEnd=a,t.trigger(" focus"),n.scrollTop=l,s()}),w(".formula-field-mode").on("change.cpf",function(){var t=w(this).val();w(".tc-var-list.other .tc-var-field").toArray().forEach(function(e){w(e).attr("data-value","{field."+w(e).attr("title")+"."+t+"}")})}),w(".tc-element-setting-edit-price").on("input.cpf",function(){s()}))}),w(c).on("click.cpf",".tc-upload-button",w.tmEPOAdmin.upload),w(c).on("change.cpf",".changes-product-image,.tm-use-lightbox,.replacement-mode",w.tmEPOAdmin.floatbox_content_js),w(c).on("change.cpf",".use_url",w.tmEPOAdmin.tm_url),w(c).on("change.cpf",".tm-pricetype-selector",w.tmEPOAdmin.tm_pricetype_selector),w(c).on("change.cpf",".tm_option_price_type",w.tmEPOAdmin.tm_option_price_type),w(c).on("change.cpf",".dynamic-mode",w.tmEPOAdmin.dynamicMode),w(c).on("change.cpf",".variations-display-as",w.tmEPOAdmin.variations_display_as),w(c).on("change.cpf",".tm-attribute .tm-changes-product-image",w.tmEPOAdmin.variations_display_as),w(c).on("change.cpf",".tm-weekday-picker",w.tmEPOAdmin.tm_weekday_picker),w(c).on("change.cpf",".tm-month-picker",w.tmEPOAdmin.tm_month_picker),w(c).on("click.cpf",".tm-tags-container .tab-header",function(){var e=w(this),t=e.closest(".tm-tags-container"),i=t.find(".tm-elements-container").find("li.tm-element-button"),t=t.find(".tab-header"),n=e.attr("data-tm-tag");t.removeClass("open").addClass("closed"),e.removeClass("closed").addClass("open"),("all"===n?i:(i.addClass("tm-hidden"),i.filter("."+n))).removeClass("tm-hidden")}),w(c).on("click.cpf",".tm_editor_wrap",function(){var e=w(this).find("textarea");e.attr("id")&&(r.wpActiveEditor=e.attr("id"))}),w(c).on("change.cpf",".cpf-logic-element",w.tmEPOAdmin.cpf_logic_element_onchange),w(c).on("change.cpf",".cpf-logic-operator",w.tmEPOAdmin.cpf_logic_operator_onchange),w(c).on("change.cpf",".activate-sections-logic, .activate-element-logic",function(){w(this).is(":checked")?w(this).closest(".message0x0").find(".builder-logic-div").show():w(this).closest(".message0x0").find(".builder-logic-div").hide()}),w(c).on("dblclick.cpf",".tm-default-radio",function(){w(this).prop("checked",!1)}),s=function(e){if(13===e.keyCode)return e.preventDefault(),w.tmEPOAdmin.force_current_edit_label=!0,d(),!1},d=function(e){var t,i,n=w.tmEPOAdmin.current_edit_label;!w.tmEPOAdmin.current_edit_label||!0!==w.tmEPOAdmin.force_current_edit_label&&(n.is(e.target)||0!==n.has(e.target).length||w(e.target).is(".tm-internal-name"))||((e=n.closest(".tm-label-desc").next(".tm-label-desc-edit").find(".tm-internal-name")).trigger("change"),n.is(".tm-internal-label")&&n.html(e.val()).removeClass("tm-hidden"),n.is(".tm-element-label")&&n.removeClass("tm-hidden").closest(".tm-label-desc").find(".tm-internal-label").html(e.val()),n.closest(".tm-label-desc").removeClass("tm-hidden").next(".tm-label-desc-edit").addClass("tm-hidden"),""===e.val()?(n.closest(".tm-label-desc").removeClass("tc-has-value").addClass("tc-empty-value"),n.closest(".tm-label-desc").find(".tm-internal-label").html(n.closest(".tm-label-desc").find(".tm-element-label").html()),e.val(n.closest(".tm-label-desc").find(".tm-element-label").html())):n.closest(".tm-label-desc").removeClass("tc-empty-value").addClass("tc-has-value"),n=e.closest(".builder-wrapper").index(),t=w.tmEPOAdmin.find_index(y[n].section.is_slider,e.closest(".bitem")),(i=e.closest(".tm-label-desc-edit")).is(".tm-for-bitem")?w.tmEPOAdmin.setFieldValue(n,t,"internal_name",e.val(),!0):i.is(".tm-for-section")&&(y[n].section.sections_internal_name.default=e.val(),y[n].sections_internal_name=e.val()),e.remove(),w.tmEPOAdmin.current_edit_label=!1,w.tmEPOAdmin.force_current_edit_label=!1,w(c).off("mouseup",d),w(c).off("keydown",s))},w(c).on("click",".tm-element-label,.tm-internal-label",function(){var e,t,i=w(this),n=(w.tmEPOAdmin.current_edit_label=i).addClass("tm-hidden").closest(".tm-label-desc").addClass("tm-hidden").next(".tm-label-desc-edit").removeClass("tm-hidden"),a=i.closest(".builder-wrapper").index(),i=w.tmEPOAdmin.find_index(y[a].section.is_slider,i.closest(".bitem"));n.is(".tm-for-bitem")?(e=n.attr("data-element"),t=w.tmEPOAdmin.getFieldValue(y[a].fields[i],"internal_name",!0)):n.is(".tm-for-section")&&(e="sections",t=y[a].section.sections_internal_name.default),e+="_internal_name",e=w("<input type='text' value='"+t.replace(/'/g,"&#39;")+"' name='tm_meta[tmfbuilder]["+e+"][]' class='t tm-internal-name'>"),n.append(e),e.trigger(" focus"),w(c).on("mouseup",d),w(c).on("keydown",s)}),w(c).on("click.cpf",".cpf-add-rule",w.tmEPOAdmin.cpf_add_rule),w(c).on("click.cpf",".cpf-delete-rule",w.tmEPOAdmin.cpf_delete_rule),w(c).on("click.cpf",".tm-logic-add-rule-set",w.tmEPOAdmin.cpf_add_rule_set),w(c).on("click.cpf",".tma-handle-wrap .tma-handle",w.tmEPOAdmin.builder_fold_onClick),w(c).on("keyup change","#tc-floatbox-content .n[type=text]",function(){var e,t,i=w(this),n=i.val();return a&&n!==t&&(e=new RegExp("[^-0-9%.\\"+a.mon_decimal_point+"]+","gi"),t=n.replace(e,""),i.val(t),0===i.parent().find(".wc_error_tip").length)&&(n=i.position(),i.after('<div class="wc_error_tip">'+a.i18n_mon_decimal_error+"</div>"),w(".wc_error_tip").css("left",n.left+i.width()-i.width()/2-w(".wc_error_tip").width()/2).css("top",n.top+i.height()).fadeIn("100")),this}),w(c).on("click",".tc-enable-responsive",function(){var e=w(this),t=e.find(".on"),i=e.find(".off"),n=w("#tc-floatbox-content").find(".builder_responsive_div");e.is(".active")?(e.removeClass("active"),t.addClass("tc-hidden"),i.removeClass("tc-hidden"),n.addClass("tc-hidden")):(e.addClass("active"),t.removeClass("tc-hidden"),i.addClass("tc-hidden"),n.removeClass("tc-hidden"))}),w(c).on("change.cpf",".product-mode",function(){var e=w("#tc-floatbox-content"),t=w(this).val(),i=w(".product-default-value-search"),n=w(".product-products-selector");"product"===t?(t="products",n.is(".enhanced")&&n.prop("multiple")&&(n.selectWoo("destroy").removeClass("enhanced"),n.prop("multiple",!1),w.tmEPOAdmin.create_products_search(e)),n.prop("multiple",!1)):"products"===t&&(n.is(".enhanced")&&!n.prop("multiple")&&(n.selectWoo("destroy").removeClass("enhanced"),n.prop("multiple",!0),w.tmEPOAdmin.create_products_search(e)),n.prop("multiple",!0)),i.is(".enhanced")&&(i.selectWoo("destroy").removeClass("enhanced"),"products"===t?(i.removeData("action"),i.addClass("enhanced-dropdown"),n.triggerHandler("change.cpf"),w.tmEPOAdmin.create_enhanced_dropdown(e)):(i.data("action","wc_epo_search_products_in_categories"),i.addClass("wc-product-search"),w.tmEPOAdmin.create_products_search(e))),w(".product-"+t+"-selector").trigger("change.cpf")}),w(c).on("change.cpf",".product-default-value-search",function(){var i,n,t=w(this),a=t.val(),l=w(".product-mode"),e={action:"wc_epo_get_product_categories",product_id:a,security:x.get_products_categories_nonce};a&&w.post(x.ajax_url,e,function(e){t.data("categoryIds","success"===e.result?e.category_ids:[]),t.data("categoryIds")&&("categories"!==l.val()||a===t.attr("data-current-selected")||(i=w(".product-categories-selector").find(":selected").toArray().map(function(e){return parseInt(w(e).val(),10)}),n=!1,w.each(t.data("categoryIds"),function(e,t){if(-1!==w.inArray(parseInt(t,10),i))return!(n=!0)}),n)?(t.attr("data-current-selected",a),t.data("current-selected-text",t.find(":selected").text())):(t.find("option").remove(),this.removeAttr("data-current-selected"),this.removeData("current-selected-text"),this.removeData("categoryIds"),this.removeData("include")))})}),w(c).on("change.cpf",".product-products-selector",function(){var e=w(this),t=w(".product-default-value-search"),e=e.find(":selected").clone().prop("selected",!1).removeAttr("data-select2-id");t.removeData("action"),t.find("option").remove(),t.append(e),t.val(t.attr("data-current-selected")).trigger("change.cpf")}),w(c).on("change.cpf",".product-categories-selector",function(){var i,n=w(this).find(":selected").toArray().map(function(e){return parseInt(w(e).val(),10)}),e=w(".product-default-value-search");e.data("include",n),e.data("action","wc_epo_search_products_in_categories"),e.data("categoryIds")&&(i=!1,w.each(e.data("categoryIds"),function(e,t){if(-1!==w.inArray(parseInt(t,10),n))return!(i=!0)}),i||(e.find("option").remove(),e.removeAttr("data-current-selected"),e.removeData("current-selected-text"),e.removeData("categoryIds")))}),w("body").on("woocommerce-product-type-change",function(){var e=w("#product-type");w.tmEPOAdmin.initSectionsCheck(),e.length&&("variable"!==e.val()&&"variable-subscription"!==e.val()&&(e=w(".builder-layout .element-variations")).length&&(e.closest(".builder-wrapper").remove(),w.tmEPOAdmin.builder_reorder_multiple(),w.tmEPOAdmin.section_logic_init(),w.tmEPOAdmin.initSectionsCheck(),w.tmEPOAdmin.toggleVariationButton(),w.tmEPOAdmin.var_remove("tm-style-variation-added")),w.tmEPOAdmin.toggleVariationButton())}),w(c).on("change.cpf",".apply-mode, .product_page_tm-global-epo #product_catdiv input:checkbox, .product_page_tm-global-epo #tm-product-ids, .product_page_tm-global-epo #tc-enabled-options, .product_page_tm-global-epo #tc-disabled-options",function(){setTimeout(function(){w.tmEPOAdmin.checkIfApplied()},100)}),w(c).on("change.cpf",".apply-mode",function(){w.tmEPOAdmin.applyMode(w(this))}),w('#product_catchecklist input[type="checkbox"]').on("change",function(){w.tmEPOAdmin.checkboxStates[this.id]=w(this).prop("checked"),setTimeout(function(){w.tmEPOAdmin.applyMode(w(".apply-mode:checked"))},100)}),t.length&&t.toArray().forEach(function(e){new MutationObserver(function(){w.tmEPOAdmin.checkIfApplied()}).observe(e,{attributes:!0,childList:!0,subtree:!0})}),w.tmEPOAdmin.addEventsDone=1)},initialitize:function(){w.tmEPOAdmin.setGlobalVariationObject("initialitize_on")},initialitize_on:function(){w.tmEPOAdmin.isinit=!0,w.tmEPOAdmin.pre_element_logic_init_obj={},w.tmEPOAdmin.pre_element_logic_init_obj_options={},w.tmEPOAdmin.pre_element_logic_init(!0),w.tmEPOAdmin.pre_element_logic_init_done=!0,w.tmEPOAdmin.is_original=x.is_original_post,w.tmEPOAdmin.current_edit_label=!1,w.tmEPOAdmin.force_current_edit_label=!1,w.tmEPOAdmin.toggleVariationButton(),w.tmEPOAdmin.addEvents(),w.tmEPOAdmin.check_section_logic(),w.tmEPOAdmin.check_element_logic(),w.tmEPOAdmin.sectionLogicStart(),w.tmEPOAdmin.elementLogicStart(),w(".builder-wrapper.tm-slider-wizard").each(function(){var e=w(this);w.tmEPOAdmin.createSlider(e)}),w("#side-sortables").prepend(w('<div class="tc-info-box hidden"></div>')),w(function(){w.tmEPOAdmin.checkIfApplied(),w.tmEPOAdmin.applyModeInit(),w.tmEPOAdmin.checkboxStates={},w('#product_catchecklist input[type="checkbox"]').each(function(){w.tmEPOAdmin.checkboxStates[this.id]=w(this).prop("checked")})}),w.tmEPOAdmin.initSectionsCheck(),w.tmEPOAdmin.fixFormSubmit(),w.tmEPOAdmin.pre_element_logic_init_done=!1,w.tmEPOAdmin.isinit=!1,w(".builder-layout").removeClass("tm-hidden"),w.tmEPOAdmin.makeResizables(w(".builder-wrapper")),w.tmEPOAdmin.makeResizables(w(".bitem"))},initialitize_on_after:function(){w.tmEPOAdmin.isinit=!0,w.tmEPOAdmin.pre_element_logic_init_obj={},w.tmEPOAdmin.pre_element_logic_init_obj_options={},w.tmEPOAdmin.pre_element_logic_init(!0),w.tmEPOAdmin.pre_element_logic_init_done=!0,w.tmEPOAdmin.is_original=x.is_original_post,w.tmEPOAdmin.current_edit_label=!1,w.tmEPOAdmin.force_current_edit_label=!1,w.tmEPOAdmin.var_remove("tm-style-variation-added"),w.tmEPOAdmin.toggleVariationButton(),w.tmEPOAdmin.addSortables(),w.tmEPOAdmin.check_section_logic(),w.tmEPOAdmin.check_element_logic(),w.tmEPOAdmin.sectionLogicStart(),w.tmEPOAdmin.elementLogicStart(),w(".builder-wrapper.tm-slider-wizard").each(function(){var e=w(this);w.tmEPOAdmin.createSlider(e)}),w.tmEPOAdmin.initSectionsCheck(),w.tmEPOAdmin.fixFormSubmit(),w.tmEPOAdmin.makeResizables(w(".builder-wrapper")),w.tmEPOAdmin.makeResizables(w(".bitem")),w.tmEPOAdmin.pre_element_logic_init_done=!1,w.tmEPOAdmin.isinit=!1},makeResizables:function(e){var r,t=Object.keys(w.tmEPOAdmin.builderSize),c=[];0!==(e=w(e)).length&&(e.toArray().forEach(function(e){(e=w(e)).css("--flex-width",e.attr("data-size"))}),x.is_original_post)&&!e.closest(".builder-layout").is(".builder-template")&&(t.forEach(function(e){c.push(parseFloat(w.tmEPOAdmin.builderSize[e].replace("%",""),10))}),e.not(".tma-nomove").toArray().forEach(function(d){var s;d=w(d),s=d.is(".bitem")?d.closest(".bitem-wrapper").first():d.closest(".builder-layout"),d.is(".ui-resizable")&&d.resizable().resizable("destroy"),d.resizable({maxWidth:s.width(),minWidth:s.width()/8,start:function(e,t){t.originalElement.addClass("tm-label-info-hidden"),r=parseFloat(w.tmEPOAdmin.builderSize[t.originalElement.attr("class").split(" ").filter(function(e){return 0===e.indexOf("w")})[0]].replace("%",""),10),t.originalElement.addClass("flex-reset")},stop:function(e,t){var i,n,a=100*t.size.width/s.width(),l=c.filter(function(e){return e<=a}),o=c.filter(function(e){return a<=e}),t=t.originalElement;t.removeClass("ui-highlight tm-label-info-hidden"),l=l[l.length-1],o=((o=void 0===(o=o[0])?c[c.length-1]:o)-(l=void 0===l?o<=r?c[c.length-1]:c[1]:l))/2<a-l?(i="w"+o.toString().replace(".","-"),t.css("width",o+"%"),o):(i="w"+l.toString().replace(".","-"),t.css("width",l+"%"),l),l=t.attr("class").split(" ").filter(function(e){return 0===e.indexOf("w")})[0],n=w.tmEPOAdmin.builderSize[i],i!==l&&(t.removeClass(String(l)),t.addClass(String(i)),t.removeClass("flex-reset"),t.css("--flex-width",String(o)),t.attr("data-size",o),(d.is(".bitem")?t.find(".bitem-inner .size"):t.find(".section-inner .size")).text(n),l=t.closest(".builder-wrapper").index(),o=w.tmEPOAdmin.find_index(y[l].section.is_slider,t),d.is(".bitem")?w.tmEPOAdmin.setFieldValue(l,o,"div_size",i):(y[l].section.sections_size.default=i,y[l].size=n)),d.is(".builder-wrapper")&&w.tmEPOAdmin.makeResizables(d.find(".bitem")),(t.is(".bitem")?t.find(".bitem-settings"):t.find(".section-settings")).removeClass("show")},resize:function(e,t){var i=100*t.size.width/s.width(),n=c.filter(function(e){return e<=i}),a=t.originalElement;void 0===(n=n[n.length-1])&&(n=c[c.length-1]),a.addClass("ui-highlight"),(a.is(".bitem")?a.find(".bitem-settings").addClass("show").find(".bitem-setting.size"):a.find(".section-settings").addClass("show").find(".section-setting.size")).html(n+"%"),t.size.height=t.originalSize.height}})}))},cpf_logic_element_onchange:function(e,t){var i,n,a,l,o,d,s,r,c=w(this),m="tc-hidden-no-events";e instanceof w&&(c=e),e=(t=void 0===t?!(t=w(this).closest(".section_elements, .builder-wrapper, .bitem, .builder-element-wrap")).is(".section_elements")&&!t.is(".builder-wrapper"):t)?2===t?w.tmEPOAdmin.elementShippingLogicObject:w.tmEPOAdmin.elementLogicObject:w.tmEPOAdmin.sectionLogicObject,t=c.val(),i=c.find("option:selected").attr("data-section"),n=c.find("option:selected").attr("data-type"),a=void 0!==(a=e)[i]&&void 0!==(a=e[i].values)[t]&&e[i].values[t],e=c.closest(".tm-logic-rule").find(".tm-logic-value"),l=(c=c.closest(".tm-logic-rule").find(".cpf-logic-operator")).val(),s=["startswith","endswith","isempty","isnotempty"],r=["startswith","endswith","greaterthan","lessthan","greaterthanequal","lessthanequal","isempty","isnotempty"],d=(o=["startswith","endswith","greaterthan","lessthan","greaterthanequal","lessthanequal"]).concat("is","isnot"),a?(a=w(a),e.empty().append(a),c.children().removeClass(m),"quantity"===n?(-1!==w.inArray(l,s)&&c.val("is"),c.children().filter(function(e,t){return-1!==w.inArray(w(t).val(),s)}).addClass(m),c.trigger("change.cpf")):"productid"===n?(-1!==w.inArray(l,r)&&c.val("is"),c.children().filter(function(e,t){return-1!==w.inArray(w(t).val(),r)}).addClass(m),c.trigger("change.cpf")):"variation"===n||"multiple"===n?(-1!==w.inArray(l,o)&&c.val("isempty"),c.children().filter(function(e,t){return-1!==w.inArray(w(t).val(),o)}).addClass(m),c.trigger("change.cpf")):c.children().filter(function(e,t){return-1!==w.inArray(w(t).val(),o)}).removeClass(m)):t===i?(-1!==w.inArray(l,d)&&c.val("isempty"),c.children().filter(function(e,t){return-1!==w.inArray(w(t).val(),d)}).addClass(m),c.trigger("change.cpf")):c.children().filter(function(e,t){return-1!==w.inArray(w(t).val(),d)}).removeClass(m)},cpf_logic_operator_onchange:function(e){var t=w(this),e=(t=e instanceof w?e:t).val(),t=t.closest(".tm-logic-rule").find(".tm-logic-value");"isempty"===e||"isnotempty"===e?t.hide():t.show()},createSlider:function(d){d.tmtabs({headers:"tm-slider-wizard-headers",header:"tm-slider-wizard-header",selectedtab:0,showonhover:function(){return w.tmEPOAdmin.isElementDragged},useclasstohide:!0,afteraddtab:function(e,t){var i,n,a=d.index();w.tmEPOAdmin.builder_items_sortable(t),d.is(".tm-slider-wizard")?(i=d.find(".bitem-wrapper").map(function(e,t){return w(t).children(".bitem").not(".pl2").length}).get().join(","),n=y[a].section.sections_tabs_labels.default||"null",(n=(n=w.epoAPI.util.parseJSON(n))||[]).push(w(e).text()),n=v.stringify(n)):(i="",(n=[]).push(w(e).text())),y[a].section.sections_slides.default=i,y[a].section.sections_tabs_labels.default=n},deletebutton:!0,deleteconfirm:!0,beforedeletetab:function(e,t){var i=d.index(),n=t.find(".bitem").length,a=w.tmEPOAdmin.find_index(!0,t.find(".bitem").first());w.tmEPOAdmin.sliderTabDeleteBefore=[],t.find(".bitem").toArray().forEach(function(e){w.tmEPOAdmin.sliderTabDeleteBefore.push({field_index:w.tmEPOAdmin.find_index(!0,w(e)),disabledFieldIndex:w.tmEPOAdmin.find_index(!0,w(e),".bitem",".element-is-disabled")})}),y[i].fields.splice(a,n),y[i].section.sections.default=parseInt(y[i].section.sections.default,10)-n,y[i].section.sections.default=y[i].section.sections.default.toString(),t=y[i].section.sections_tabs_labels.default||"null",t=(t=w.epoAPI.util.parseJSON(t))||[],a=e.closest(".tm-box").index(),t.splice(a,1),t=v.stringify(t),y[i].section.sections_tabs_labels.default=t},afterdeletetab:function(){var e,i=d.index(),n=0,t=d.is(".tm-slider-wizard")?d.find(".bitem-wrapper").map(function(e,t){return w(t).children(".bitem").not(".pl2").length}).get().join(","):"";d.is(".is-slider")&&(e=[],d.find(".tm-slider-wizard-header").toArray().forEach(function(e){w(e).find(".tab-text").html(w(e).closest(".tm-box").index()+1)}),e=v.stringify(e),y[i].section.sections_tabs_labels.default=e),y[i].section.sections_slides.default=t,w.tmEPOAdmin.sliderTabDeleteBefore.forEach(function(e,t){w.tmEPOAdmin.builderItemsSortableObj.start.section=y[i].section.sections_uniqid.default,w.tmEPOAdmin.builderItemsSortableObj.start.section_eq=i.toString(),w.tmEPOAdmin.builderItemsSortableObj.start.element=-1===w.tmEPOAdmin.sliderTabDeleteBefore[t].disabledFieldIndex?"-1":parseInt(w.tmEPOAdmin.sliderTabDeleteBefore[t].disabledFieldIndex,10)-t+n,-1===w.tmEPOAdmin.sliderTabDeleteBefore[t].disabledFieldIndex&&(w.tmEPOAdmin.builderItemsSortableObj.start.disabled=!0,w.tmEPOAdmin.builderItemsSortableObj.start.disabledFieldIndex=-1,n+=1),w.tmEPOAdmin.builderItemsSortableObj.end.section="delete",w.tmEPOAdmin.builderItemsSortableObj.end.section_eq="delete",w.tmEPOAdmin.builderItemsSortableObj.end.element="delete",w.tmEPOAdmin.builderItemsSortableObj.end.novalidate="delete",w.tmEPOAdmin.logic_reindex()}),w.tmEPOAdmin.builder_reorder_multiple(),w.tmEPOAdmin.section_logic_init(),w.tmEPOAdmin.initSectionsCheck()},aftermovetab:function(e,t){var i,n=d.index();y[n].section.sections_slides.default=w(".builder-wrapper").eq(n).find(".bitem-wrapper").map(function(e,t){return w(t).children(".bitem").not(".pl2").length}).get().join(","),i=y[n].section.sections_tabs_labels.default||"null",t=(i=(i=w.epoAPI.util.parseJSON(i))||[]).splice(t,1)[0],i.splice(e,0,t),i=v.stringify(i),y[n].section.sections_tabs_labels.default=i,w.tmEPOAdmin.section_logic_init(),w.tmEPOAdmin.initSectionsCheck(),d.is(".is-slider")&&(i=[],d.find(".tm-slider-wizard-header").toArray().forEach(function(e){var t=w(e).closest(".tm-box").index()+1;w(e).find(".tab-text").html(t),i.push(t)}),i=v.stringify(i),y[n].section.sections_tabs_labels.default=i)},beforemovebitem:function(e,t,i,n,a){var l=d.index();w.tmEPOAdmin.builderItemsSortableObj.start.section=y[l].section.sections_uniqid.default,w.tmEPOAdmin.builderItemsSortableObj.start.section_eq=l.toString(),w.tmEPOAdmin.builderItemsSortableObj.start.element=w.tmEPOAdmin.find_index(!0,a).toString(),w.tmEPOAdmin.builderItemsSortableObj.start.disabledFieldIndex=w.tmEPOAdmin.find_index(!0,a,".bitem",".element-is-disabled")},aftermovebitem:function(e,t,i,n,a){var l=d.index(),o=w.tmEPOAdmin.find_index(!0,a);w.tmEPOAdmin.builderItemsSortableObj.end.section=y[l].section.sections_uniqid.default,w.tmEPOAdmin.builderItemsSortableObj.end.section_eq=l.toString(),w.tmEPOAdmin.builderItemsSortableObj.end.element=w.tmEPOAdmin.find_index(!0,a).toString(),w.tmEPOAdmin.builderItemsSortableObj.end.disabledFieldIndex=w.tmEPOAdmin.find_index(!0,a,".bitem",".element-is-disabled"),y[l].fields.splice(o,0,y[w.tmEPOAdmin.builderItemsSortableObj.start.section_eq].fields.splice(w.tmEPOAdmin.builderItemsSortableObj.start.element,1)[0]),w.tmEPOAdmin.builder_reorder_multiple(),w.tmEPOAdmin.logic_reindex()},editbutton:d.is(".is-tabs"),oneditbutton:function(t){var i=d.index(),n=y[i].section.sections_tabs_labels.default||"null",a=t.closest(".tm-box").index(),e=w.tmEPOAdmin.builder_floatbox_template({id:"tc-floatbox-content-pop",update:x.i18n_save,html:'<div class="tm-inner"><input type="text" class="tc-element-setting-edit-tab"></div>',title:x.i18n_edit_tab},"tc-floatbox-edit"),l=w.tcFloatBox({closefadeouttime:0,animateOut:"",ismodal:!1,minWidth:"400px",classname:"flasho tc-wrapper",data:e,cancelClass:".floatbox-edit-cancel",unique:!0}),o=this;n=(n=w.epoAPI.util.parseJSON(n))||[],w(".tc-element-setting-edit-tab").val(n[a]),w(".floatbox-edit-update").on("click.cpf",function(e){e.preventDefault(),n[a]=w(".tc-element-setting-edit-tab").val(),t.closest(".tm-slider-wizard-header").find(".tab-text").html(n[a]),n=v.stringify(n),y[i].section.sections_tabs_labels.default=n,l.destroy(),o.trigger("refresh")})},addbutton:!!w.tmEPOAdmin.is_original}),y[d.index()].section.is_slider=!0},sections_type_onChange:function(e){var t,i,n,a=y[e].section.sections_type.default,l=w(".builder-wrapper").eq(e);"slider"!==a&&"tabs"!==a||!l.hasClass("tm-slider-wizard")?"slider"!==a&&"tabs"!==a||l.hasClass("tm-slider-wizard")?"slider"!==a&&"tabs"!==a&&l.hasClass("tm-slider-wizard")&&(l.find(".bitem-wrapper").wrapAll('<div class="tmtemp"></div>'),l.find(".bitem-wrapper .bitem").appendTo(l.find(".tmtemp")),l.find(".bitem-wrapper").remove(),l.find(".tmtemp").addClass("bitem-wrapper").removeClass("tmtemp"),w.tmEPOAdmin.builder_items_sortable(l.find(".bitem-wrapper")),l.find(".tm-slider-wizard-headers").remove(),l.find(".tc-tab-headers-wrap").remove(),l.removeClass("tm-slider-wizard is-tabs is-slider has-add-button"),l.removeData("tctabs").removeData("tmHasTmtabs"),y[e].section.sections_slides.default="",y[e].section.sections_tabs_labels.default="",y[e].section.is_slider=!1):(t=l.find(".bitem-wrapper"),n=l.find(".btitle"),l.addClass("tm-slider-wizard is-"+a),n.after('<div class="transition tm-slider-wizard-headers"><div class="transition tm-slider-wizard-headers-inner"><div class="tm-box"><h4 class="tm-slider-wizard-header" data-id="tc-tab-slide0"><span class="tab-text">1</span></h4></div></div></div>'),t.addClass("tc-tab-slide tc-tab-slide0"),w.tmEPOAdmin.createSlider(l),y[e].section.sections_slides.default=l.find(".bitem-wrapper").map(function(e,t){return w(t).children(".bitem").not(".pl2").length}).get().join(","),y[e].section.is_slider=!0,y[e].section.sections_tabs_labels.default=v.stringify(["1"])):l.is(".is-slider")&&"tabs"===a?(i=[],l.find(".tc-scroll-left-arrow, .tc-scroll-right-arrow, .tm-add-tab").remove(),l.find(".tm-slider-wizard-header").toArray().forEach(function(e){e=w(e).find(".tab-text");void 0!==e.data("tabtext")&&e.html(e.data("tabtext")),i.push(e.text())}),i=v.stringify(i),l.find(".tm-slider-wizard-headers").unwrap(),l.removeClass("is-slider").addClass("is-tabs").tcTabs("set",{editbutton:!0}),y[e].section.sections_tabs_labels.default=i):l.is(".is-tabs")&&"slider"===a&&(l.find(".tc-scroll-left-arrow, .tc-scroll-right-arrow, .tm-add-tab").remove(),l.find(".tm-slider-wizard-headers").unwrap(),l.removeClass("is-tabs has-add-button").addClass("is-slider").tcTabs("set",{editbutton:!1}),l.find(".tm-slider-wizard-header").toArray().forEach(function(e){var e=w(e),t=e.find(".tab-text"),e=e.closest(".tm-box").index()+1;t.data("tabtext",t.text()),t.html(e)}),y[e].section.sections_tabs_labels.default="")},variationEventsSuccess:function(){setTimeout(function(){w.tmEPOAdmin.setGlobalVariationObject("reindex")},600),w(c).unbind("ajaxSuccess",w.tmEPOAdmin.variationEventsSuccess),w.tmEPOAdmin.var_remove("tma-remove_variation-added")},variationsCheckEventsSuccess:function(){setTimeout(function(){w.tmEPOAdmin.variationsCheckForChanges=1,w.tmEPOAdmin.tm_variations_check()},600),w(c).unbind("ajaxSuccess",w.tmEPOAdmin.variationsCheckEventsSuccess),w.tmEPOAdmin.var_remove("tma-remove_variation-added")},addVariationEvents:function(){!0!==w.tmEPOAdmin.var_is("tma-variation-events-added")&&(!0!==w.tmEPOAdmin.var_is("tma-remove_variation-added")&&w("#variable_product_options").on("click.tma",".remove_variation",function(){w(c).ajaxSuccess(w.tmEPOAdmin.variationEventsSuccess),w.tmEPOAdmin.var_is("tma-remove_variation-added",!0),w(c).ajaxSuccess(w.tmEPOAdmin.variationsCheckEventsSuccess)}),!0!==w.tmEPOAdmin.var_is("tma-remove_variation-added")&&w(".wc-metaboxes-wrapper").on("click","a.bulk_edit",function(){"delete_all"===w("select#field_to_edit").val()&&(w(c).ajaxSuccess(w.tmEPOAdmin.variationEventsSuccess),w.tmEPOAdmin.var_is("tma-remove_variation-added",!0),w(c).ajaxSuccess(w.tmEPOAdmin.variationsCheckEventsSuccess))}),w("#variable_product_options").on("woocommerce_variations_added",function(){w.tmEPOAdmin.setGlobalVariationObject("reindex"),w(c).ajaxSuccess(w.tmEPOAdmin.variationsCheckEventsSuccess)}),w("#woocommerce-product-data").on("woocommerce_variations_saved",function(){w.tmEPOAdmin.setGlobalVariationObject("reindex"),w(c).ajaxSuccess(w.tmEPOAdmin.variationsCheckEventsSuccess)}),w(c).on("click.cpf",".save_attributes",function(){w(c).ajaxSuccess(w.tmEPOAdmin.variationsCheckEventsSuccess)}),w.tmEPOAdmin.var_is("tma-variation-events-added",!0))},toggleVariationButton:function(){var e,t,i=w("#product-type");i.length&&("variable"===i.val()||"variable-subscription"===i.val()?(w(".builder_add_section").addClass("inline"),w(".builder_add_variation").addClass("inline").removeClass("tm-hidden"),w(".tma-variations-wrap").removeClass("tm-hidden"),w.tmEPOAdmin.addVariationEvents(),i=!1,(e=w(".builder-layout .element-variations")).length?"1"===w.tmEPOAdmin.getFieldValue(w.tmEPOAdmin.variationSection,"variations_disabled")&&(i=!0,e=w(".builder-layout .element-variations"),w.tmEPOAdmin.var_is("tm-style-variation-forced",!0)):(w.tmEPOAdmin.var_is("tm-style-variation-forced",!0),w.tmEPOAdmin.builder_add_variation_onClick(),i=!0,e=w(".builder-layout .element-variations")),e.length&&((t=e.closest(".builder-wrapper")).find(".tm-add-element-action,.tmicon.clone,.tmicon.size,.tmicon.move,.tmicon.plus,.tmicon.minus").remove(),t.addClass("tma-nomove tma-variations-wrap"),w.tmEPOAdmin.var_is("tm-style-variation-added",!0),e.addClass("tma-nomove"),e.find(".bitem-settings .size,.bitem-settings .clone,.tm-label-move,.bitem-settings .plus,.change,.bitem-settings .minus,.tm-label-delete").remove(),i?(w.tmEPOAdmin.setFieldValue(w.tmEPOAdmin.variationSectionIndex,w.tmEPOAdmin.variationFieldIndex,"variations_disabled","1"),w(".builder_add_section").addClass("inline"),w(".builder_add_variation").addClass("inline").removeClass("tm-hidden"),w(".tma-variations-wrap").addClass("tm-hidden")):(w.tmEPOAdmin.setFieldValue(w.tmEPOAdmin.variationSectionIndex,w.tmEPOAdmin.variationFieldIndex,"variations_disabled",""),w(".builder_add_section").removeClass("inline"),w(".builder_add_variation").removeClass("inline").addClass("tm-hidden"),w(".tma-variations-wrap").removeClass("tm-hidden")),w.tmEPOAdmin.variationsCheckForChanges=1,w.tmEPOAdmin.tm_variations_check()),1<w(".tma-variations-wrap").length&&w(".tma-variations-wrap").not(":first").each(function(){var e=w(this).closest(".builder-wrapper"),t=e.index();e.remove(),y.splice(t,1),w.tmEPOAdmin.builder_reorder_multiple(),w.tmEPOAdmin.section_logic_init(),w.tmEPOAdmin.initSectionsCheck()})):(w(".builder_add_section").removeClass("inline"),w(".builder_add_variation").removeClass("inline").addClass("tm-hidden")))},tcSerializeJsOptionsArray:function(e){var t=[].concat.apply([],e.map(function(t){return Object.keys(t.section).map(function(e){return t&&"object"==typeof t.section[e]?t.section[e]:null}).filter(function(e){return null!=e})})),i=[].concat.apply([],e.map(function(e){return[].concat.apply([],e.fields.map(function(e){return[].concat.apply([],e.filter(function(e){return null!==e}).map(function(e){return e&&"multiple"===e.id?[].concat.apply([],e.multiple):e}))}))}));return e=(e=[].concat.apply([],[t,i])).map(function(e){return e?void 0===e.checked||!0===e.checked?{name:e.tags.name,value:e.default}:{name:e.tags.name,value:""}:{}}).filter(function(e){return null!=e})},tcSerializeJsOptionsObject:function(e){var t={},e=w.tmEPOAdmin.tcSerializeJsOptionsArray(e);return w("#tm_meta_priority").length&&e.push({name:"tm_meta[priority]",value:w("#tm_meta_priority").val()}),w.each(e,function(){void 0!==t[this.name]?"[]"===this.name.slice(-2)?(t[this.name].push||(t[this.name]=[t[this.name]]),t[this.name].push(this.value||"")):""===t[this.name]&&(t[this.name]=this.value||""):null!==this.value&&void 0!==this.value&&this.value.push?t[this.name]=[this.value]:t[this.name]=this.value||""}),t},checkSections:function(t){return Object.keys(t).forEach(function(e){t[e].section.sections.default=t[e].fields.length}),t},prepareForJson:function(t){var i,n,a={};return Object.keys(t).forEach(function(e){0===e.indexOf("tm_meta[")&&((i=e.split(/[[\]]{1,2}/)).pop(),i=i.map(function(e){return""===e?null:e}),n=0<i.length&&null===i[i.length-1],i=i.filter(function(e){return null!=e?e:null}),n="object"!=typeof t[e]&&n?[t[e]]:t[e],a=w.tmEPOAdmin.constructObject(i,n,a))}),a},constructObject:function(e,t,i){var n=e.shift();return 0<e.length?(Object.prototype.hasOwnProperty.call(i,n)||(i[n]={}),i[n]=w.tmEPOAdmin.constructObject(e,t,i[n])):i[n]=t,i},createTmMetaSerialized:function(){var e,t,i=w("input#wp-preview"),n=w("#tmformfieldsbuilderwrap");w(".tm_meta_serialized").remove(),w(".tm_meta_serialized_wpml").remove(),t=w.tmEPOAdmin.is_original?"tm_meta_serialized":"tm_meta_serialized_wpml",y=w.tmEPOAdmin.checkSections(y),e=w.tmEPOAdmin.tm_escape(v.stringify(w.tmEPOAdmin.prepareForJson(w.tmEPOAdmin.tcSerializeJsOptionsObject(y)))),t=w("<textarea class='tm_meta_serialized tm-hidden' name='"+t+"'></textarea>").val(e),n.prepend(t),0<i.length&&""!==i.val()&&w(".tm_meta_serialized").remove()},fixFormSubmit:function(){var n,e=w("#post");1===e.length?e.on("submit",function(){return w.tmEPOAdmin.createTmMetaSerialized(),!0}):_.data&&void 0!==_.data.subscribe&&(n=!1,"function"==typeof(e=_.data.subscribe))&&e(function(){var e,t,i;_.data.select("core/editor")&&(t=_.data.select("core/editor").didPostSaveRequestSucceed(),i=_.data.select("core/editor").didPostSaveRequestFail(),_&&_.data&&_.data.select("core/editor")&&(e=_.data.select("core/editor").isSavingPost()),!n&&e&&(n=!0,w.tmEPOAdmin.createTmMetaSerialized()),n)&&(t||i)&&(n=!1,setTimeout(function(){w(".tm_meta_serialized").remove(),w(".tm_meta_serialized_wpml").remove()},600))})},initSectionsCheck:function(){var e=w(".builder-wrapper").length;(e=1===e&&w(".builder-wrapper.tma-variations-wrap.tm-hidden").length?0:e)?(w(".builder-add-section-action").show(),w(".builder-selector").show(),w(".tc-welcome").hide(),w(".builder-layout").removeClass("tm-hidden")):(w(".builder-add-section-action").hide(),w(".builder-selector").hide(),w(".tc-welcome").show(),w(".builder-layout").addClass("tm-hidden"))},applyModeInit:function(){setTimeout(function(){w.tmEPOAdmin.applyMode(w(".apply-mode:checked"))},100)},applyMode:function(e){var t,i,e=e.val(),n="disable-form"===e||"customize-selection"===e&&!w("#product_catchecklist :checkbox:checked").length?1:0,a=w("#tm-product-ids"),l=w("#tm-product-exclude-ids"),o=w("#tc-enabled-options"),d=w("#tc-disabled-options");if("apply-to-all-products"===e)w("#product_catchecklist").find(":checkbox").prop("checked",!1);else for(t in w.tmEPOAdmin.checkboxStates)w("#"+t).prop("checked",w.tmEPOAdmin.checkboxStates[t]);"apply-to-all-products"===e||"customize-selection"===e?((i=l.data("saved-exclude-ids"))&&i.length&&(l.html(w.map(i,function(e){return e.html}).join("")),l.find("option").each(function(e){i[e].checked&&w(this).prop("selected",!0)}),l.removeData("saved-exclude-ids")),(i=o.data("saved-enabled-roles"))&&i.length&&(o.html(w.map(i,function(e){return e.html}).join("")),o.find("option").each(function(e){i[e].checked&&w(this).prop("selected",!0)}),o.removeData("saved-enabled-roles")),(i=d.data("saved-disabled-roles"))&&i.length&&(d.html(w.map(i,function(e){return e.html}).join("")),d.find("option").each(function(e){i[e].checked&&w(this).prop("selected",!0)}),d.removeData("saved-disabled-roles"))):"disable-form"===e&&(i=l.find("option").map(function(){return{html:w(this).prop("outerHTML"),checked:w(this).prop("selected")}}).get(),l.data("saved-exclude-ids",i),l.html(""),i=o.find("option").map(function(){return{html:w(this).prop("outerHTML"),checked:w(this).prop("selected")}}).get(),o.data("saved-enabled-roles",i),o.html(""),i=d.find("option").map(function(){return{html:w(this).prop("outerHTML"),checked:w(this).prop("selected")}}).get(),d.data("saved-disabled-roles",i),d.html("")),"customize-selection"===e?(i=a.data("saved-include-ids"))&&i.length&&(a.html(w.map(i,function(e){return e.html}).join("")),a.find("option").each(function(e){i[e].checked&&w(this).prop("selected",!0)}),a.removeData("saved-include-ids")):"apply-to-all-products"!==e&&"disable-form"!==e||(i=a.data("saved-include-ids"))&&i.length||(i=a.find("option").map(function(){return{html:w(this).prop("outerHTML"),checked:w(this).prop("selected")}}).get(),a.data("saved-include-ids",i),a.html("")),"apply-to-all-products"===e?(w("#product_catdiv").hide(),w('.postbox[id^="tagsdiv-"]').hide(),w("#tc-product-search").hide(),w("#tc-product-exclude").show(),w("#tc-product-roles").show()):"customize-selection"===e?(w("#product_catdiv").show(),w('.postbox[id^="tagsdiv-"]').show(),w("#tc-product-search").show(),w("#tc-product-exclude").show(),w("#tc-product-roles").show()):"disable-form"===e&&(w("#product_catdiv").hide(),w('.postbox[id^="tagsdiv-"]').hide(),w("#tc-product-search").hide(),w("#tc-product-exclude").hide(),w("#tc-product-roles").hide()),w("#tm_meta_disable_categories").val(n)},checkIfApplied:function(){var e,t,i,n,a;w("body").is(".product_page_tm-global-epo")&&(e=w(".apply-mode:checked").val(),t=0<w("#product_catdiv input:checkbox").filter(":checked").length,a=0<w(".tagchecklist").children("li").length,i=w("#tm-product-ids").val(),n=w("#tc-enabled-options").val(),i=!(!i||null===i)&&0<i.length,n=!(!n||null===n)&&0<n.length,"apply-to-all-products"===e?w(".tc-info-box").removeClass("hidden error").addClass("tc-all-products").html(x.i18n_form_is_applied_to_all):"customize-selection"===e&&(t||a||i||n)?w(".tc-info-box").removeClass("tc-error tc-all-products").addClass("hidden").html(""):w(".tc-info-box").removeClass("hidden tc-all-products").addClass("tc-error").html(x.i18n_form_not_applied_to_all))},check_section_logic:function(e){var i;!(Number.isFinite(e)||e instanceof w)&&w.tmEPOAdmin.isinit&&w.tmEPOAdmin.done_check_section_logic||(void 0===(e=e instanceof w?parseInt(e.index(),10):e)?i=y:(i=[],e=w.epoAPI.math.toFloat(e),i[e]=y[e]),Object.keys(i).forEach(function(e){var t=i[e];void 0===t.section||(t=t.section.sections_uniqid.default)&&""!==t&&void 0!==t&&!1!==t||(y[e].section.sections_uniqid.default=w.epoAPI.math.uniqueid("",!0))}),w.tmEPOAdmin.done_check_section_logic=!0)},check_element_logic:function(e,t){var n,a,l,o,d=[],s=!1;!(Number.isFinite(e)||e instanceof w)&&w.tmEPOAdmin.isinit&&w.tmEPOAdmin.done_check_element_logic||(e instanceof w&&e.length&&(t=e.closest(".builder-wrapper").index(),y[t])&&y[t].section&&(e=w.tmEPOAdmin.find_index(y[t].section.is_slider,e)),void 0===t&&void 0!==e)||(void 0===e?(n=y,s=!0):(n=[],t=w.epoAPI.math.toFloat(t),e=w.epoAPI.math.toFloat(e),n[t]=w.extend(!0,{},y[t]),l=n[t].fields[e],n[t].fields=[],n[t].fields[e]=l),Object.keys(n).forEach(function(i){a=n[i].fields,Object.keys(a).forEach(function(e){var t;l=a[e],o=w.tmEPOAdmin.getFieldValue(l,"element_type"),t=w.tmEPOAdmin.getFieldValue(l,"uniqid",o),(s&&-1!==d.indexOf(t)||!t||""===t||void 0===t||!1===t)&&w.tmEPOAdmin.setFieldValue(i,e,"uniqid",w.epoAPI.math.uniqueid("",!0),o),s&&d.push(w.tmEPOAdmin.getFieldValue(y[i].fields[e],"uniqid",o))})}),w.tmEPOAdmin.done_check_element_logic=!0)},sectionLogicStart:function(e){var t,i;void 0===e?t=y:(t=[],e=w.epoAPI.math.toFloat(e),t[e]=w.extend(!0,{},y[e])),Object.keys(t).forEach(function(e){w.tmEPOAdmin.section_logic_init(e);try{i=t[e].section.sections_logicrules.default||"null",i=w.epoAPI.util.parseJSON(i),i=w.tmEPOAdmin.logic_check_section_rules(i),y[e].section.sections_logicrules.default=v.stringify(i),y[e].section.rules_toggle=i.toggle}catch(e){}})},elementLogicStart:function(e,t){var i,n,a,l,o,d;void 0===e?a=y:(a=[],t=w.epoAPI.math.toFloat(t),e=w.epoAPI.math.toFloat(e),a[t]=w.extend(!0,{},y[t]),o=a[t].fields[e],a[t].fields=[],a[t].fields[e]=o),Object.keys(a).forEach(function(t){void 0!==(l=a[t].fields)&&Object.keys(l).forEach(function(e){o=l[e],w.tmEPOAdmin.element_logic_init(e,t);try{d=w.tmEPOAdmin.getFieldValue(o,"element_type"),n=w.tmEPOAdmin.getFieldValue(o,"logic",d)||"null",i=w.tmEPOAdmin.getFieldValue(o,"logicrules",d)||"null",i=w.epoAPI.util.parseJSON(i),n&&"null"!==n&&(i=w.tmEPOAdmin.logic_check_element_rules(i,t,e)),w.tmEPOAdmin.setFieldValue(t,e,"logicrules",v.stringify(i),d)}catch(e){}})})},panelsReorder:function(e){w(e).children(".options-wrap").each(function(e,t){w(t).find(".tm-default-radio,.tm-default-checkbox").val(e)})},panelsSortable:function(e){0!==w(e).length&&w.tmEPOAdmin.is_original&&e.sortablejs({handle:".move",forceFallback:!0,fallbackClass:"sortable-fallback",onStart:function(e){w.tmEPOAdmin.panelsReorder(w(e.item).closest(".panels_wrap"))}})},builder_panel_delete_all_onClick:function(e){var t=w(this).closest(".onerow").find(".tcpagination"),i=w(".flasho.tc-wrapper").find(".panels_wrap");e.preventDefault(),w(this).trigger("hideTtooltip"),t.tcPagination("destroy"),1<i.children().length&&((e=i.find(".options-wrap")).each(function(e){if(0===e)return!0;w(this).remove(),i.find(".numorder").each(function(e){w(this).html(parseInt(e,10)+1)})}),e.find("input").val(""),w.tmEPOAdmin.panelsReorder(i))},builder_image_delete_onClick:function(e){var t=w(this);e.preventDefault(),t.trigger("hideTtooltip"),t.closest(".tc-upload-image-wrap").removeClass("has-image").find("input.tm_option_image").val("").removeClass("has-image"),t.closest(".tm_upload_image").find("img").attr("src","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=")},builder_panel_delete_onClick:function(e){var t=w(this).closest(".panels_wrap");e.preventDefault(),w(this).trigger("hideTtooltip"),1<t.children().length&&w(this).closest(".options-wrap").css({margin:"0 auto"}).animate({opacity:0,height:0,width:0},300,function(){w(this).remove(),t.find(".numorder").each(function(e){w(this).html(parseInt(e,10)+1)}),t.children(".options-wrap").each(function(t){w(this).find("[id]").each(function(){var e=w(this).attr("name").replace(/[[\]]/g,"");w(this).attr("id",e+"_"+t)})}),w.tmEPOAdmin.panelsReorder(t)})},builder_panel_mass_add_onClick:function(e){var t=w(this);e.preventDefault(),t.is(".disabled")||(t.addClass("disabled"),e='<div class="tm-panel-populate-wrapper"><textarea class="tm-panel-populate"></textarea><button type="button" class="tc tc-button builder-panel-populate">'+x.i18n_populate+"</button></div>",t.after(e))},builder_panel_populate_onClick:function(e){var i=w(".flasho.tc-wrapper").find(".panels_wrap"),n=i.children(),a=w(""),t=w(".tm-panel-populate").val().split(/\n/),l=[];e.preventDefault(),w(this).remove(),t.forEach(function(e){/\S/.test(e)&&l.push(w.epoAPI.util.trim(e))}),l.forEach(function(e){var e=e.split("|"),t=e.length;0!==t&&(1===t&&(e[1]=""),e[0]=w.epoAPI.util.trim(e[0]),void 0!==e[1]&&""!==e[1]?e[1]=parseFloat(w.epoAPI.util.trim(e[1])):e[1]="",Number.isFinite(e[1])||(e[1]=""),t=w.tmEPOAdmin.add_panel_row(e,i,n),a=a.add(t))}),a.length&&(i.append(a),a.find(".tc-option-enabled").prop("checked",!0).val("1").trigger("changechoice"),a.find(".tc-cell-dnmpbq .c").trigger("changednmpbq"),a.find(".tc-cell-fee .c").trigger("changefee"),w.tcToolTip(a.find(".tm-tooltip"))),w(".builder-panel-mass-add").removeClass("disabled"),w(".tm-panel-populate-wrapper").remove(),w.tmEPOAdmin.paginattion_init("last"),w.tmEPOAdmin.floatbox_content_js()},add_panel_row:function(e,t,i){var n=i.last().tcClone();return n?(w.tmEPOAdmin.builder_clone_elements_after_events(n),n.find("[name]").val(""),n.find(".tm_option_title").val(e[0]),n.find(".tm_option_value").val(w("<div/>").html(e[0]).text()),n.find(".tm_option_price").val(e[1]),e[2]&&(n.find(".tm_option_price_type").val(e[2]),!1===n.find(".tm_option_price_type").val())&&n.find(".tm_option_price_type").val(""),e[3]&&(n.find(".tm_option_description").val(e[3]),!1===n.find(".tm_option_description").val())&&n.find(".tm_option_description").val(""),n.find(".tm_upload_image img").attr("src",""),n.find("input.tm_option_image").val(""),n.find(".tm-default-radio,.tm-default-checkbox").prop("checked",!1).val(i.length),n):w("")},builder_panel_add_separator_onClick:function(e){var t=w(this).prevUntil(".panels_wrap").prev(),i=t.children(),n=i.last().tcClone();e.preventDefault(),n&&(n.addClass("separator"),n.find(".tc-cell:not(.tc-cell-control,.tc-cell-title,.tc-cell-description)").addClass("tm-hidden"),n.find("[name]").val(""),n.find(".tc-cell-value input").removeClass("tm_option_value").val("-1"),n.find(".tm_upload_image img").attr("src",""),n.find("input.tm_option_image").val(""),n.find(".tm-default-radio,.tm-default-checkbox").prop("checked",!1).val(i.length),w.tmEPOAdmin.builder_clone_elements_after_events(n),t.append(n),n.find("input:checkbox").toArray().forEach(function(e){(e=w(e)).val(e.data("builder").tags.value),e.is(".tc-option-enabled")&&e.prop("checked",!0).trigger("changechoice")}),w.tcToolTip(n.find(".tm-tooltip")),w.tmEPOAdmin.paginattion_init("last"),w.tmEPOAdmin.floatbox_content_js())},builder_panel_add_onClick:function(e){var t=w(this).prevUntil(".panels_wrap").prev(),i=t.children().not(".separator"),n=i.last().tcClone();e.preventDefault(),n&&(n.find("[name]").val(""),n.find(".tm_upload_image img").attr("src",""),n.find("input.tm_option_image").val(""),n.find(".tm-default-radio,.tm-default-checkbox").prop("checked",!1).val(i.length),w.tmEPOAdmin.builder_clone_elements_after_events(n),t.append(n),n.find("input:checkbox").toArray().forEach(function(e){(e=w(e)).val(e.data("builder").tags.value),e.is(".tc-option-enabled")&&e.prop("checked",!0).trigger("changechoice")}),w.tcToolTip(n.find(".tm-tooltip")),w.tmEPOAdmin.paginattion_init("last"),w.tmEPOAdmin.floatbox_content_js())},builder_add_section_onClick:function(e,t,i){var n,a,l=w.epoAPI.template.html(g.tc_builder_section,{});return e&&e.preventDefault(),!(!l||!(e=w(l)))&&(e.addClass("w100"),e.find(".tm-builder-sections-uniqid").val(w.epoAPI.math.uniqueid("",!0)),n=w.tmEPOAdmin.getFieldObject(e),a={},Object.keys(n).forEach(function(e){a[n[e].id]=n[e]}),l={fields:[],section:a,size:w.tmEPOAdmin.builderSize[a.sections_size.default],sections_internal_name:a.sections_internal_name.default},e.find(".section_elements").empty(),e.find(".tm-internal-name").remove(),t?(e.appendTo(".builder-layout"),y.push(l)):0<w(".builder-layout .tma-variations-wrap").length?(w(".builder-layout .tma-variations-wrap").after(e),y.splice(1,0,l)):(e.prependTo(".builder-layout"),y.unshift(l)),w.tmEPOAdmin.check_section_logic(e),w.tmEPOAdmin.section_logic_init(e),i||(w.tmEPOAdmin.builder_items_sortable(e.find(".bitem-wrapper")),w.tmEPOAdmin.builder_reorder_multiple(),w(this).is("a")&&w(r).tcScrollTo(e)),w.tmEPOAdmin.initSectionsCheck(),w.tmEPOAdmin.makeResizables(e),e)},builder_add_element_onClick:function(e){var n=w(this),t=w.tmEPOAdmin.builder_floatbox_template_import({id:"tc-floatbox-content",html:'<div class="tm-inner">'+x.element_data+"</div>",title:x.i18n_add_element}),a=w.tcFloatBox({closefadeouttime:0,animateOut:"",ismodal:!1,width:"70%",height:"70%",classname:"flasho tc-wrapper tc-builder-add-element",cancelEvent:function(e){e.destroy(),w("body").removeClass("floatbox-open")},cancelClass:".floatbox-cancel",data:t});e&&e.preventDefault(),w(".tc-builder-add-element .tc-element-button").on("click.cpf",function(e){var t=n.closest(".builder-wrapper"),i=w(this).attr("data-element");e.preventDefault(),n.is(".tc-prepend")?w.tmEPOAdmin.builder_clone_element(i,t,"prepend"):w.tmEPOAdmin.builder_clone_element(i,t),w.tmEPOAdmin.logic_reindex(),a.destroy(),w("body").removeClass("floatbox-open")}),w("body").addClass("floatbox-open")},builder_add_section_and_element_onClick:function(e){var t=w.tmEPOAdmin.builder_floatbox_template_import({id:"tc-floatbox-content",html:'<div class="tm-inner">'+x.element_data+"</div>",title:x.i18n_add_element}),i=w.tcFloatBox({closefadeouttime:0,animateOut:"",ismodal:!1,width:"70%",height:"70%",classname:"flasho tc-wrapper tc-builder-add-section-and-element",cancelEvent:function(e){e.destroy(),w("body").removeClass("floatbox-open")},cancelClass:".floatbox-cancel",data:t});e&&e.preventDefault(),w(".tc-builder-add-section-and-element .tc-element-button").on("click.cpf",function(e){var t=w.tmEPOAdmin.builder_add_section_onClick(!1,!0);e.preventDefault(),t&&(e=w(this).attr("data-element"),w.tmEPOAdmin.builder_clone_element(e,t),w.tmEPOAdmin.logic_reindex(),i.destroy()),w("body").removeClass("floatbox-open")}),w("body").addClass("floatbox-open")},tm_variations_check:function(){var e,i;w(".builder-layout .element-variations").length&&1===w.tmEPOAdmin.variationsCheckForChanges&&l&&(w("#tc-admin-extra-product-options").block({message:null}),e={action:"woocommerce_tm_variations_check",post_id:l.post_id,security:l.check_attributes_nonce},w.post(l.ajax_url,e,function(e){y[0].variations_html=e.html,w(".tma-variations-wrap .tm-all-attributes").html(e.html),e.jsobject&&(y[0].jsobject=e.jsobject,y[0].fields[0].find(function(e,t){return"multiple"===e.id&&(i=t),"multiple"===e.id}),void 0!==i?y[0].fields[0][i]=e.jsobject:y[0].fields[0].push(e.jsobject)),w("#tc-admin-extra-product-options").unblock(),w("#tc-admin-extra-product-options").trigger("woocommerce_tm_variations_check_loaded"),w.tmEPOAdmin.variationsCheckForChanges=0,w.tmEPOAdmin.builder_reorder_multiple()},"json"))},builder_variation_delete_onClick:function(){w.tmEPOAdmin.var_is("tm-style-variation-forced",!0),w(".builder_add_section").addClass("inline"),w(".builder_add_variation").addClass("inline").removeClass("tm-hidden"),1<w(".tma-variations-wrap").length&&w(".tma-variations-wrap").not(":first").each(function(){var e=w(this).closest(".builder-wrapper"),t=e.index();e.remove(),y.splice(t,1),w.tmEPOAdmin.builder_reorder_multiple(),w.tmEPOAdmin.section_logic_init(),w.tmEPOAdmin.initSectionsCheck()}),w(".tma-variations-wrap").addClass("tm-hidden"),w.tmEPOAdmin.setFieldValue(w.tmEPOAdmin.variationSectionIndex,w.tmEPOAdmin.variationFieldIndex,"variations_disabled","1"),w.tmEPOAdmin.initSectionsCheck()},builder_add_variation_onClick:function(e){e&&e.preventDefault(),!0===w.tmEPOAdmin.var_is("tm-style-variation-added")?!0===w.tmEPOAdmin.var_is("tm-style-variation-forced")&&(w.tmEPOAdmin.var_is("tm-style-variation-forced",!1),w(".builder_add_variation").addClass("tm-hidden"),w(".builder_add_section").removeClass("inline"),w(".tma-variations-wrap").removeClass("tm-hidden"),w.tmEPOAdmin.setFieldValue(w.tmEPOAdmin.variationSectionIndex,w.tmEPOAdmin.variationFieldIndex,"variations_disabled",""),w.tmEPOAdmin.initSectionsCheck()):(e=w.tmEPOAdmin.builder_add_section_onClick(!1,!1,!0))&&(e.find(".tm-add-element-action,.tmicon.clone,.tmicon.size,.tmicon.move,.tmicon.plus,.tmicon.minus").remove(),e.addClass("tma-nomove tma-variations-wrap"),w.tmEPOAdmin.var_is("tm-style-variation-added",!0),e=w.tmEPOAdmin.builder_clone_element("variations",w(".builder-layout").find(".builder-wrapper").first()),w.tmEPOAdmin.setVariationSection(),!0===w.tmEPOAdmin.var_is("tm-style-variation-forced")?(w(".builder_add_section").addClass("inline"),w(".builder_add_variation").addClass("inline").removeClass("tm-hidden"),w(".tma-variations-wrap").addClass("tm-hidden"),w.tmEPOAdmin.setFieldValue(w.tmEPOAdmin.variationSectionIndex,w.tmEPOAdmin.variationFieldIndex,"variations_disabled","1")):(w(".builder_add_variation").addClass("tm-hidden"),w(".builder_add_section").removeClass("inline"),w(".tma-variations-wrap").removeClass("tm-hidden"),w.tmEPOAdmin.var_is("tm-style-variation-forced",!1),w.tmEPOAdmin.setFieldValue(w.tmEPOAdmin.variationSectionIndex,w.tmEPOAdmin.variationFieldIndex,"variations_disabled","")),e.find(".bitem-settings .size,.bitem-settings .clone,.tm-label-move,.bitem-settings .plus,.bitem-settings .minus,.tm-label-delete").remove(),e.addClass("tma-nomove"),e.find(".builder-remove-for-variations").remove(),e.find(".builder_hide_for_variation").hide(),w.tmEPOAdmin.pre_element_logic_init_set(),w.tmEPOAdmin.logic_reindex_force(),w.tmEPOAdmin.variationsCheckForChanges=1,w.tmEPOAdmin.tm_variations_check())},var_is:function(e,t){if(!t)return w("body").data(e);w("body").data(e,t)},var_remove:function(e){e&&w("body").removeData(e)},tm_escape:function(e){return encodeURIComponent(e)},tm_unescape:function(e){return decodeURIComponent(e)},get_element_logic_init:function(e){return w.tmEPOAdmin.pre_element_logic_init_done||w.tmEPOAdmin.pre_element_logic_init(e),w.tmEPOAdmin.isinit?w.tmEPOAdmin.pre_element_logic_init_done=!0:w.tmEPOAdmin.pre_element_logic_init_done=!1,w.tmEPOAdmin.pre_element_logic_init_obj},get_element_logic_options_init:function(e){return w.tmEPOAdmin.pre_element_logic_init_done||w.tmEPOAdmin.pre_element_logic_init(e),w.tmEPOAdmin.isinit?w.tmEPOAdmin.pre_element_logic_init_done=!0:w.tmEPOAdmin.pre_element_logic_init_done=!1,w.tmEPOAdmin.pre_element_logic_init_obj_options},find_index:function(e,t,i,n){var a=0;return e&&(a=t.closest(".bitem-wrapper").prevAll(".bitem-wrapper").find(".bitem"),a=(a=n?a.not(n):a).length),i&&n?(e=t.parent().find(i).not(n),-1!==(e=parseInt(e.index(t),10))?parseInt(a,10)+e:e):parseInt(a,10)+parseInt(t.index(),10)},setGlobalVariationObject:function(t,i){var e,n;l?(w("#tc-admin-extra-product-options").block({message:null}),e={action:"woocommerce_tm_get_variations_array",post_id:l.post_id,security:l.check_attributes_nonce},n=r.ajaxurl||l.ajax_url,w.post(n,e,function(e){e&&(k=e,!0===t?w.tmEPOAdmin.pre_element_logic_init_set(i):"reindex"===t?w.tmEPOAdmin.logic_reindex_force():"initialitize_on"===t?w.tmEPOAdmin.initialitize_on():"initialitize_on_after"===t&&w.tmEPOAdmin.initialitize_on_after())},"json").always(function(){w("#tc-admin-extra-product-options").unblock()})):"initialitize_on"===t?(k=k||{},w.tmEPOAdmin.initialitize_on()):"initialitize_on_after"===t&&(k=k||{},w.tmEPOAdmin.initialitize_on_after())},pre_element_logic_init:function(e){k?w.tmEPOAdmin.pre_element_logic_init_set(e):w.tmEPOAdmin.setGlobalVariationObject(!0,e)},getFieldValue:function(e,t,i){if((i&&!0!==i||!0===i&&(i=w.tmEPOAdmin.getFieldValue(e,"element_type")))&&(t=i+"_"+t),void 0!==(i=e.find(function(e){return e.id===t}))&&"object"==typeof i)return i.default},getFieldMultiple:function(e,t,i){var n,a;if(t="options_"+t,t="multiple_"+(t=i&&!0!==i||!0===i&&(i=w.tmEPOAdmin.getFieldValue(e,"element_type"))?i+"_"+t:t),e.find(function(e,t){return"multiple"===e.id&&(n=t),"multiple"===e.id}),void 0!==n&&(a=e[n].multiple.map(function(e){return e.find(function(e){return e.id===t})}).filter(function(e){return null!=e}))&&"object"==typeof a)return a},setFieldValue:function(e,t,i,n,a){var l;(a&&!0!==a||!0===a&&(a=w.tmEPOAdmin.getFieldValue(y[e].fields[t],"element_type")))&&(i=a+"_"+i),a=y[e].fields[t],Array.isArray(a)&&a.find(function(e,t){return e.id===i&&(l=t),e.id===i}),void 0!==l&&(y[e].fields[t][l].default=n)},setFieldValueMultiple:function(e,t,i,n,a){var l,o;i.toString.isNumeric()?o=i:(i="options_"+i,i="multiple_"+(i=a&&!0!==a||!0===a&&(a=w.tmEPOAdmin.getFieldValue(y[e].fields[t],"element_type"))?a+"_"+i:i)),y[e].fields[t].find(function(e,t){return"multiple"===e.id&&(l=t),"multiple"===e.id}),void 0!==l&&(a=y[e].fields[t][l].multiple,void 0===o?a.find(function(e,t){return e.id===i&&(o=t),e.id===i}):y[e].fields[t][l].multiple[o].default=n)},setVariationSection:function(){y.find(function(e,t){var i,n;return void 0!==(n=void 0!==e&&void 0!==e.fields?e.fields.find(function(e,t){e=e.find(function(e){return"element_type"===e.id&&"variations"===e.default});return void 0!==e&&(i=t),e}):n)&&(w.tmEPOAdmin.variationSectionIndex=t,w.tmEPOAdmin.variationFieldIndex=i,w.tmEPOAdmin.variationSection=y[w.tmEPOAdmin.variationSectionIndex].fields[w.tmEPOAdmin.variationFieldIndex],y[w.tmEPOAdmin.variationSectionIndex].section.tma_variations_wrap=!0),void 0!==n})},pre_element_logic_init_set:function(t){var i,n,a,l,o,d,s,r,c,m,u,p,f,_,h,b,g,v,O,A,E,P;k&&(w.tmEPOAdmin.pre_element_logic_init_obj={},w.tmEPOAdmin.pre_element_logic_init_obj_options={},n={},a=[],(i={productgroup_start:[]}).productgroup_start[0]='<optgroup label="Product properties">',i[l="product-properties"]=[],s=[],u=x.i18n_quantity,i[l][1]='<option data-type="'+"quantity"+'" data-section="'+l+'" value="0">'+u+"</option>",s[0]='<input data-element="0" data-section="'+l+'" class="cpf-logic-value" type="text" value="">',u=x.i18n_product_id,i[l][2]='<option data-type="'+"productid"+'" data-section="'+l+'" value="1">'+u+"</option>",s[1]='<input data-element="1" data-section="'+l+'" class="cpf-logic-value" type="text" value="">',u=x.i18n_variations,i[l][3]='<option data-type="'+"variation"+'" data-section="'+l+'" value="2">'+u+"</option>",s[2]='<input data-element="2" data-section="'+l+'" class="cpf-logic-value" type="text" value="">',n[l]={values:s},i.productgroup_end=[],i.productgroup_end[0]="</optgroup>",w.tmEPOAdmin.setVariationSection(),i.addons_start=[],i.addons_start[0]='<optgroup label="Addons">',Object.keys(y).forEach(function(e){void 0!==(A=y[e].section)&&(l=A.sections_uniqid.default,-1!==a.indexOf(l)&&(y[e].section.sections_uniqid.default=w.epoAPI.math.uniqueid("",!0),l=y[e].section.sections_uniqid.default),a.push(l),i[l]=[],t&&w.tmEPOAdmin.check_section_logic(e),v=A.sections_internal_name.default||"Section",A.tma_variations_wrap||(i[l][0]='<option data-type="section" data-section="'+l+'" value="'+l+'">'+v+" ("+l+")</option>"),o=y[e].fields.filter(function(e){var t=w.tmEPOAdmin.getFieldValue(e,"element_type");return"variations"===t||-1!==w.inArray(t,w.tmEPOAdmin.canTakeLogic)&&"1"===w.tmEPOAdmin.getFieldValue(e,"enabled",t)}),d=y[e].fields.filter(function(e){var t=w.tmEPOAdmin.getFieldValue(e,"element_type");return"1"===w.tmEPOAdmin.getFieldValue(e,"enabled",t)||void 0===w.tmEPOAdmin.getFieldValue(e,"enabled",t)}),s=[],r=[],Object.keys(o).forEach(function(e){if(E=o[e],O=w.tmEPOAdmin.getFieldValue(E,"element_type"),c=w.tmEPOAdmin.getFieldValue(E,"header_title",O),P=w.tmEPOAdmin.getFieldValue(E,"uniqid",O),m=d.findIndex(function(e){var t=w.tmEPOAdmin.getFieldValue(e,"element_type");return P===w.tmEPOAdmin.getFieldValue(e,"uniqid",t)&&("variations"===t||-1!==w.inArray(t,w.tmEPOAdmin.canTakeLogic)&&"1"===w.tmEPOAdmin.getFieldValue(e,"enabled",!0))}),p=w.tmEPOAdmin.getFieldValue(E,"enabled",O),f="1"===w.tmEPOAdmin.getFieldValue(E,"enabled",O),p&&!f)return!0;void 0!==c&&(void 0!==(u=c)&&0!==u.length||(u=""),(p=w.tmEPOAdmin.getFieldValue(E,"internal_name",O))!==u&&(u=u+" ("+p+")"),f="variations"===O?"variation":-1!==w.inArray(O,["radiobuttons","checkboxes","product","selectbox","selectboxmultiple"])?"multiple":"text",i[l][m+1]='<option data-type="'+f+'" data-section="'+l+'" value="'+m+'">'+u+"</option>","variations"===O?(r=[],w(k.variations).each(function(e,t){var i="publish"===(i=t.status||"invalid")?"":" ("+i+")";_=[],w(t.attributes).each(function(e,t){t=w.map(t,function(e){return e});w(t).each(function(e,t){_.push(t)})}),_=_.join(" - "),h=_;try{h=w.tmEPOAdmin.tm_unescape(_)}catch(e){h=_}r.push('<option value="'+w.tmEPOAdmin.tm_escape(t.variation_id)+'">'+h+i+"</option>")}),s[m]='<select data-element="'+m+'" data-section="'+l+'" class="cpf-logic-value">'+r.join("")+"</select>"):-1!==w.inArray(O,["radiobuttons","checkboxes","selectbox","selectboxmultiple"])?(b=w.tmEPOAdmin.getFieldMultiple(E,"title",O),g=w.tmEPOAdmin.getFieldMultiple(E,"value",O),r=[],Object.keys(b).forEach(function(e){r.push('<option value="'+w.tmEPOAdmin.tm_escape(g[e].default)+'">'+b[e].default+"</option>")}),s[m]='<select data-element="'+m+'" data-section="'+l+'" class="cpf-logic-value">'+r.join("")+"</select>"):s[m]='<input data-element="'+m+'" data-section="'+l+'" class="cpf-logic-value" type="text" value="">')}),n[l]={values:s})}),i.addons_end=[],i.addons_end[0]="</optgroup>",w.tmEPOAdmin.pre_element_logic_init_obj=n,w.tmEPOAdmin.pre_element_logic_init_obj_options=i)},element_logic_init:function(e,t,i){var n,a,l,o,d,s,r=[],c=[],m={};e instanceof w&&(t=e.closest(".builder-wrapper").index(),e=w.tmEPOAdmin.find_index(y[t].section.is_slider,e)),t=w.epoAPI.math.toFloat(t),e=w.epoAPI.math.toFloat(e),s=w.tmEPOAdmin.getFieldValue(y[t].fields[e],"uniqid",!0),l=y[t].fields.filter(function(e){var t=w.tmEPOAdmin.getFieldValue(e,"element_type");return"1"===w.tmEPOAdmin.getFieldValue(e,"enabled",t)||void 0===w.tmEPOAdmin.getFieldValue(e,"enabled",t)}),n=l.findIndex(function(e){var t=w.tmEPOAdmin.getFieldValue(e,"element_type");return s===w.tmEPOAdmin.getFieldValue(e,"uniqid",t)&&-1!==w.inArray(t,w.tmEPOAdmin.canTakeLogic)&&"1"===w.tmEPOAdmin.getFieldValue(e,"enabled",!0)}),w.tmEPOAdmin.check_section_logic(),w.tmEPOAdmin.check_element_logic(e,t),l=w.extend(!0,{},w.tmEPOAdmin.get_element_logic_init()),m=w.extend(!0,{},l),d=w.extend(!0,{},w.tmEPOAdmin.get_element_logic_options_init()),o=w.extend(!0,{},w.tmEPOAdmin.get_element_logic_options_init()),(a=y[t].section.sections_uniqid.default)&&l[a]&&l[a].values[n]?(m[a]={values:m[a].values},m[a].values.forEach(function(e,t){n!==t&&delete m[a].values[t]}),delete l[a].values[n],delete d[a][n+1],delete d[a][0]):a&&d[a]&&d[a][0]&&delete d[a][0],w.each(d,function(e,t){t&&w.each(t,function(e,t){t&&c.push(t)})}),w.each(o,function(e,t){e===a&&w.each(t,function(e,t){e===n+1&&r.push(t)})}),w.tmEPOAdmin.elementLogicObject.init||(w.tmEPOAdmin.elementLogicObject.init=!0),w.tmEPOAdmin.elementLogicObject=w.extend(w.tmEPOAdmin.elementLogicObject,l),w.tmEPOAdmin.elementShippingLogicObject.init||(w.tmEPOAdmin.elementShippingLogicObject.init=!0),w.tmEPOAdmin.elementShippingLogicObject=w.extend(w.tmEPOAdmin.elementShippingLogicObject,m),i&&(w.tmEPOAdmin.logic_append(i,c,"element",t,e),w.tmEPOAdmin.shipping_logic_append(i,r,"element",t,e,"enable"),w.tmEPOAdmin.shipping_logic_append(i,r,"element",t,e,"disable"))},section_logic_init:function(e,t){var i,n,a,l=[],o={};e instanceof w?e=parseInt(e.index(),10):void 0!==e&&(e=w.epoAPI.math.toFloat(e)),void 0===e?a=y:(a=[])[e]=w.extend(!0,{},y[e]),w.tmEPOAdmin.check_section_logic(e),Object.keys(a).forEach(function(e){void 0!==y[e].section&&(o=w.extend(!0,{},w.tmEPOAdmin.get_element_logic_init(!0)),i=w.extend(!0,{},w.tmEPOAdmin.get_element_logic_options_init(!0)),(n=y[e].section.sections_uniqid.default)&&o[n]&&(delete o[n],delete i[n]),w.each(i,function(e,t){t&&w.each(t,function(e,t){t&&l.push(t)})}),w.tmEPOAdmin.sectionLogicObject.init||(w.tmEPOAdmin.sectionLogicObject.init=!0),w.tmEPOAdmin.sectionLogicObject=w.extend(w.tmEPOAdmin.sectionLogicObject,o),t)&&w.tmEPOAdmin.logic_append(t,l,"section",e)})},logic_check_section_rules:function(e){var n,a;return void 0===(e="object"==typeof e&&null!==e?e:{}).toggle&&(e.toggle="show"),void 0===e.rules&&(e.rules=[]),e=w.tmEPOAdmin.convert_rules(e),n=w.epoAPI.util.deepCopyArray(e),a=w.tmEPOAdmin.sectionLogicObject,w.each(e.rules,function(i,e){Array.isArray(e)&&(w.each(e,function(e,t){void 0!==a[t.section]&&void 0!==a[t.section].values[t.element]||t.section===t.element||delete n.rules[i][e]}),0===n.rules[i].length&&delete n.rules[i],n.rules[i]=A(n.rules[i]))}),n.rules=A(n.rules),n},logic_check_element_rules:function(e,t,n){var a,l,o=!1;return void 0===(e="object"==typeof e&&e?e:{}).toggle&&(e.toggle="show"),void 0===e.rules&&(e.rules=[]),e=w.tmEPOAdmin.convert_rules(e),a=w.epoAPI.util.deepCopyArray(e),l=w.tmEPOAdmin.elementLogicObject,w.each(e.rules,function(i,e){Array.isArray(e)&&(w.each(e,function(e,t){void 0!==l[t.section]&&void 0!==l[t.section].values[t.element]||t.section===t.element||(delete a.rules[i][e],o=!0)}),0===a.rules[i].length?delete a.rules[i]:a.rules[i]=A(a.rules[i])),o&&void 0!==t&&void 0!==n&&w(".builder-layout").find(".builder-wrapper").eq(t).find(".bitem").eq(n).addClass("tm-wrong-rule")}),a.rules=A(a.rules),a},shipping_logic_check_element_rules:function(e){return void 0===(e="object"==typeof e&&e?e:{}).toggle&&(e.toggle="show"),void 0===e.rules&&(e.rules=[]),e},convert_rules:function(e){return e.what&&("all"===e.what?e.rules=[e.rules]:"any"===e.what&&(e.rules=e.rules.reduce(function(e,t){return e.push([t]),e},[])),delete e.what),e},shipping_logic_append:function(e,t,i,n,a,l){var o,d,s,r,c,m,u,p;if(e=w(e),e=w(e).find(".tm-shipping-"+l+"-logicrules + .shipping-logic-div .tm-logic-wrapper"),!t||1!==t.length)return e.html('<div class="errortitle">'+x.i18n_cannot_apply_shippingrules+"</div>"),!1;try{c=w.tmEPOAdmin.getFieldValue(y[n].fields[a],"shipping_methods_"+l+"_logicrules",!0)||"null",o=w.epoAPI.util.parseJSON(c),p=w.tmEPOAdmin.shipping_logic_check_element_rules(o),w.tmEPOAdmin.setFieldValue(n,a,"shipping_methods_"+l+"_logicrules",v.stringify(p),!0)}catch(e){p=!1}e.empty(),d='<fieldset class="tm-logic-rule-set"><legend>OR</legend><div class="tm-logic-rule-wrap"></div></fieldset>',r=w('<div class="tc-row tm-logic-rule"><div class="tc-cell tc-col-auto tm-logic-element"></div><div class="tc-cell tc-col-auto tm-logic-operator"></div><div class="tc-cell tc-col-auto tm-logic-value"></div><div class="tc-cell tc-col-auto tm-logic-func"><button type="button" class="tmicon tcfa tcfa-plus add cpf-add-rule"></button> <button type="button" class="tmicon tcfa tcfa-trash delete cpf-delete-rule"></button></div></div>'),c=w('<select class="cpf-logic-element">'+t.join("")+"</select>"),m="",Object.keys(w.tmEPOAdmin.logicOperators).forEach(function(e){m=m+'<option value="'+e+'">'+w.tmEPOAdmin.logicOperators[e]+"</option>"}),m=w('<select class="cpf-logic-operator">'+m+"</select>"),r.find(".tm-logic-element").append(c),r.find(".tm-logic-operator").append(m),p&&void 0!==p.rules&&p.rules.length?(u=w('<div class="temp" />'),w.each(p.rules,function(e,t){s=w(d),t&&"object"==typeof t&&(Array.isArray(t)&&(t.length?w.each(t,function(e,t){s.find(".tm-logic-rule-wrap").append(w.tmEPOAdmin.logic_append_rule(t,r,i,!0))}):s.find(".tm-logic-rule-wrap").append(w.tmEPOAdmin.logic_append_rule({},r,i,!0))),u.append(s))}),u=u.children(),e.append(u).removeClass("tc-hidden")):(u=w('<div class="temp" />'),(s=w(d)).find(".tm-logic-rule-wrap").append(w.tmEPOAdmin.logic_append_rule({},r,i,!0)),u.append(s),u=u.children(),e.append(u),u.find(".cpf-logic-element").trigger("change.cpf",["element"===i]),u.find(".cpf-logic-operator").val(u.find(".cpf-logic-operator").children(":not(.tc-hidden-no-events)").eq(0).val()).trigger("change.cpf",["element"===i]),e.addClass("tc-hidden"))},logic_append:function(e,t,i,n,a){var l,o,d,s,r,c,m,u;if(e=w(e),e=w(e).find(".builder-logic-div .tm-logic-wrapper"),!t||0===t.length)return e.html('<div class="errortitle">'+x.i18n_cannot_apply_rules+"</div>"),!1;try{r="1"===("element"===i?w.tmEPOAdmin.getFieldValue(y[n].fields[a],"logic",!0)||"":y[n].section.sections_logic.default||"")?"element"===i?w.tmEPOAdmin.getFieldValue(y[n].fields[a],"logicrules",!0)||"null":y[n].section.sections_logicrules.default||"null":"null",l=w.epoAPI.util.parseJSON(r),u="element"===i?w.tmEPOAdmin.logic_check_element_rules(l):w.tmEPOAdmin.logic_check_section_rules(l),"element"===i?w.tmEPOAdmin.setFieldValue(n,a,"logicrules",v.stringify(u),!0):y[n].section.sections_logicrules.default=v.stringify(u)}catch(e){u=!1}e.empty(),o='<fieldset class="tm-logic-rule-set"><legend>OR</legend><div class="tm-logic-rule-wrap"></div></fieldset>',s=w('<div class="tc-row tm-logic-rule"><div class="tc-cell tc-col-auto tm-logic-element"></div><div class="tc-cell tc-col-auto tm-logic-operator"></div><div class="tc-cell tc-col-auto tm-logic-value"></div><div class="tc-cell tc-col-auto tm-logic-func"><button type="button" class="tmicon tcfa tcfa-plus add cpf-add-rule"></button> <button type="button" class="tmicon tcfa tcfa-trash delete cpf-delete-rule"></button></div></div>'),r=w('<select class="cpf-logic-element">'+t.join("")+"</select>"),c="",Object.keys(w.tmEPOAdmin.logicOperators).forEach(function(e){c=c+'<option value="'+e+'">'+w.tmEPOAdmin.logicOperators[e]+"</option>"}),c=w('<select class="cpf-logic-operator">'+c+"</select>"),s.find(".tm-logic-element").append(r),s.find(".tm-logic-operator").append(c),u&&void 0!==u.rules&&u.rules.length?(u=w.tmEPOAdmin.convert_rules(u),m=w('<div class="temp" />'),w.each(u.rules,function(e,t){d=w(o),t&&"object"==typeof t&&(Array.isArray(t)&&(t.length?w.each(t,function(e,t){d.find(".tm-logic-rule-wrap").append(w.tmEPOAdmin.logic_append_rule(t,s,i))}):d.find(".tm-logic-rule-wrap").append(w.tmEPOAdmin.logic_append_rule({},s,i))),m.append(d))}),m=m.children(),e.append(m)):(m=w('<div class="temp" />'),(d=w(o)).find(".tm-logic-rule-wrap").append(w.tmEPOAdmin.logic_append_rule({},s,i)),m.append(d),m=m.children(),e.append(m),m.find(".cpf-logic-element").trigger("change.cpf",["element"===i]),m.find(".cpf-logic-operator").val(m.find(".cpf-logic-operator").children(":not(.tc-hidden-no-events)").eq(0).val()).trigger("change.cpf",["element"===i]))},logic_append_rule:function(e,t,i,n){var t=t.clone(),a=t.find(".cpf-logic-element").find('option[data-section="'+e.section+'"][value="'+e.element+'"]');return w(a).length&&(w(a)[0].selected=!0),w.tmEPOAdmin.cpf_logic_element_onchange(t.find(".cpf-logic-element"),n?2:"element"===i),t.find(".cpf-logic-operator").val(e.operator),w.tmEPOAdmin.cpf_logic_operator_onchange(t.find(".cpf-logic-operator"),"element"===i),void 0===e.value&&(e.value=""),t.find(".cpf-logic-value").is("select")?t.find(".cpf-logic-value").val(w.tmEPOAdmin.tm_escape(w.tmEPOAdmin.tm_unescape(e.value))):t.find(".cpf-logic-value").val(w.tmEPOAdmin.tm_unescape(e.value)),t},logic_get_JSON:function(e,t,i){var n,a,l,o,e=w(e).find(".builder-logic-div"),d={},s=e.find(".epo-rule-toggle").val();return d[t]=i,d.toggle=s,d.rules=[],e.find(".tm-logic-wrapper").children(".tm-logic-rule-set").each(function(e,t){var i=[];(t=w(t)).find(".tm-logic-rule-wrap").children(".tm-logic-rule").each(function(e,t){t=w(t),a=t.find(".cpf-logic-element"),n=a.find("option:selected").attr("data-section"),a=a.val(),l=t.find(".cpf-logic-operator").val(),void 0===(o=t.find(".cpf-logic-value").val())&&(o=""),t.find(".cpf-logic-value").is("select")||(o=w.tmEPOAdmin.tm_escape(o)),i.push({section:n,element:a,operator:l,value:o})}),d.rules.push(i)}),v.stringify(d)},shipping_logic_get_JSON:function(e,t,i,n){var a,l,o,d,e=w(e).find(".tm-shipping-"+n+"-logicrules + .shipping-logic-div"),s={},n=e.find(".tm-logic-wrapper");return n.is(".tc-hidden")?"":(s[t]=i,s.toggle="show",s.rules=[],n.children(".tm-logic-rule-set").each(function(e,t){var i=[];(t=w(t)).find(".tm-logic-rule-wrap").children(".tm-logic-rule").each(function(e,t){t=w(t),l=t.find(".cpf-logic-element"),a=l.find("option:selected").attr("data-section"),l=l.val(),o=t.find(".cpf-logic-operator").val(),void 0===(d=t.find(".cpf-logic-value").val())&&(d=""),t.find(".cpf-logic-value").is("select")||(d=w.tmEPOAdmin.tm_escape(d)),i.push({section:a,element:l,operator:o,value:d})}),s.rules.push(i)}),v.stringify(s))},section_logic_get_JSON:function(e){var t,i="";return e.find(".activate-sections-logic").is(":checked")&&(t=e.find(".tm-builder-sections-uniqid").val(),i=w.tmEPOAdmin.logic_get_JSON(e,"section",t)),i},element_logic_get_JSON:function(e){var t,i="";return e.find(".activate-element-logic").is(":checked")&&(t=e.find(".tm-builder-element-uniqid").val(),i=w.tmEPOAdmin.logic_get_JSON(e,"element",t)),i},element_shipping_logic_get_JSON:function(e,t){var i=e.find(".tm-builder-element-uniqid").val();return w.tmEPOAdmin.shipping_logic_get_JSON(e,"element",i,t)},cpf_add_rule:function(e){var t=w(this).closest(".tm-logic-rule"),i=t.tcClone(!0);e.preventDefault(),i&&t.after(i)},cpf_add_rule_set:function(e){var t=w(this).closest(".builder-logic-div, .shipping-logic-div").find(".tm-logic-wrapper"),i=t.find(".tm-logic-rule-set:last()");e.preventDefault(),t.is(".tc-hidden")?t.removeClass("tc-hidden"):(e=i.tcClone(!0))&&(e.find(".tm-logic-rule:not(:first)").remove(),i.after(e),e.find(".tm-logic-rule:first .cpf-logic-element").prop("selectedIndex",0).trigger("change.cpf"))},cpf_delete_rule:function(e){var t=w(this),i=t.closest(".tm-logic-wrapper"),n=t.closest(".tm-logic-rule-set"),a=1<i.children(".tm-logic-rule-set").length,l=n.find(".tm-logic-rule-wrap").children(".tm-logic-rule").length;e.preventDefault(),t.trigger("hideTtooltip"),1<l||a?t.closest(".tm-logic-rule").css({margin:"0 auto"}).animate({opacity:0,height:0,width:0},300,function(){(a&&1===l?n:w(this)).remove()}):i.addClass("tc-hidden")},section_logic_reindex:function(){var o=w.tmEPOAdmin.builderItemsSortableObj;Object.keys(y).forEach(function(n){var a,e=n,l=[],t=y[n].section.sections_logicrules.default||"null";return!y[n].section.sections_logic.default||!((t=w.epoAPI.util.parseJSON(t))&&void 0!==t.rules&&0<t.rules.length)||(t=w.tmEPOAdmin.convert_rules(t),o.end.section_eq===e?w.each(t.rules,function(i,e){Array.isArray(e)&&(l[i]=[],w.each(e,function(e,t){a=w.epoAPI.util.deepCopyArray(t),t.element>o.start.element&&t.section===o.start.section&&(a.element=parseInt(a.element,10)-1),l[i][e]=w.tmEPOAdmin.validate_rule(a,n)}),l[i]=A(l[i]))}):w.each(t.rules,function(i,e){Array.isArray(e)&&(l[i]=[],w.each(e,function(e,t){a=w.epoAPI.util.deepCopyArray(t),"check"!==o.start.section&&(t.section===o.start.section&&t.section===o.end.section?t.element===o.start.element?(a.section=o.end.section,a.element=o.end.element):parseInt(t.element,10)>parseInt(o.start.element,10)&&parseInt(t.element,10)<=parseInt(o.end.element,10)?a.element=parseInt(a.element,10)-1:parseInt(t.element,10)<parseInt(o.start.element,10)&&parseInt(t.element,10)>=parseInt(o.end.element,10)&&(a.element=parseInt(a.element,10)+1):t.section===o.start.section&&t.section!==o.end.section?t.element===o.start.element?(a.section=o.end.section,a.element=o.end.element):parseInt(t.element,10)>parseInt(o.start.element,10)&&a.section!==a.element&&(a.element=parseInt(a.element,10)-1):t.section!==o.start.section&&t.section===o.end.section&&t.section!==t.element&&parseInt(t.element,10)>=parseInt(o.end.element,10)&&(a.element=parseInt(a.element,10)+1)),"delete"===o.end.section&&"delete"===a.element||(l[i][e]=w.tmEPOAdmin.validate_rule(a,n))}),l[i]=A(l[i]))}),0===(l=A(l)).length&&(y[n].section.sections_logic.default=""),t.rules=l,void(y[n].section.sections_logicrules.default=v.stringify(t)))})},element_logic_reindex:function(){var i,n,a=w.tmEPOAdmin.builderItemsSortableObj,e=a.start.disabledFieldIndex;e&&(a.start.element=e.toString()),(e=a.end.disabledFieldIndex)&&(a.end.element=e.toString()),Object.keys(y).forEach(function(t){Object.keys(y[t].fields).forEach(function(e){i=y[t].fields[e],n=w.tmEPOAdmin.getFieldValue(i,"element_type"),w.tmEPOAdmin.do_element_logic_reindex(i,n,t,e,a),w.tmEPOAdmin.do_element_shipping_logic_reindex(i,n,t,e,a,"enable"),w.tmEPOAdmin.do_element_shipping_logic_reindex(i,n,t,e,a,"disable")})})},do_element_logic_reindex:function(e,t,n,a,l){var o,d;return!(w.tmEPOAdmin.getFieldValue(e,"logic",t)&&(o=[],e=w.tmEPOAdmin.getFieldValue(e,"logicrules",t),e=w.epoAPI.util.parseJSON(e),e=w.tmEPOAdmin.convert_rules(e))&&void 0!==e.rules&&0<e.rules.length)||(w.each(e.rules,function(i,e){Array.isArray(e)&&(o[i]=[],w.each(e,function(e,t){if(d=w.epoAPI.util.deepCopyArray(t),void 0===t.element)return!0;t.element=t.element.toString(),"check"!==l.start.section&&(t.section===l.start.section&&t.section===l.end.section?t.element===l.start.element?d.element=l.end.element:t.section!==t.element&&parseInt(t.element,10)>parseInt(l.start.element,10)&&parseInt(t.element,10)<=parseInt(l.end.element,10)?d.element=parseInt(d.element,10)-1:t.section!==t.element&&parseInt(t.element,10)<parseInt(l.start.element,10)&&parseInt(t.element,10)>=parseInt(l.end.element,10)&&(d.element=parseInt(d.element,10)+1):t.section===l.start.section&&t.section!==l.end.section?t.element===l.start.element?(d.section=l.end.section,d.element=l.end.element):t.section!==t.element&&!w.tmEPOAdmin.builderItemsSortableObj.start.disabled&&parseInt(t.element,10)>parseInt(l.start.element,10)&&(d.element=parseInt(d.element,10)-1):t.section!==l.start.section&&t.section===l.end.section&&t.section!==t.element&&parseInt(t.element,10)>=parseInt(l.end.element,10)&&(d.element=parseInt(d.element,10)+1)),"delete"===l.end.section&&"delete"===d.element||(w.tmEPOAdmin.builderItemsSortableObj.end.novalidate&&"delete"===w.tmEPOAdmin.builderItemsSortableObj.end.novalidate?o[i][e]=d:o[i][e]=w.tmEPOAdmin.validate_rule(d,n,a))}),0===o[i].length?delete o[i]:o[i]=A(o[i]))}),0===(o=A(o)).length&&w.tmEPOAdmin.setFieldValue(n,a,"logic","",t),e.rules=o,void w.tmEPOAdmin.setFieldValue(n,a,"logicrules",v.stringify(e),t))},do_element_shipping_logic_reindex:function(e,t,i,n,a,l){var o,d,l="shipping_methods_"+l+"_logicrules",e=w.tmEPOAdmin.getFieldValue(e,l,t);return!(e&&(o=[],e=w.epoAPI.util.parseJSON(e))&&void 0!==e.rules&&0<e.rules.length)||(w.each(e.rules,function(i,e){Array.isArray(e)&&(o[i]=[],w.each(e,function(e,t){if(d=w.epoAPI.util.deepCopyArray(t),void 0===t.element)return!0;t.element=t.element.toString(),"check"!==a.start.section&&(t.section===a.start.section&&t.section===a.end.section?t.element===a.start.element?d.element=a.end.element:t.section!==t.element&&parseInt(t.element,10)>parseInt(a.start.element,10)&&parseInt(t.element,10)<=parseInt(a.end.element,10)?d.element=parseInt(d.element,10)-1:t.section!==t.element&&parseInt(t.element,10)<parseInt(a.start.element,10)&&parseInt(t.element,10)>=parseInt(a.end.element,10)&&(d.element=parseInt(d.element,10)+1):t.section===a.start.section&&t.section!==a.end.section?t.element===a.start.element?(d.section=a.end.section,d.element=a.end.element):t.section!==t.element&&!w.tmEPOAdmin.builderItemsSortableObj.start.disabled&&parseInt(t.element,10)>parseInt(a.start.element,10)&&(d.element=parseInt(d.element,10)-1):t.section!==a.start.section&&t.section===a.end.section&&t.section!==t.element&&parseInt(t.element,10)>=parseInt(a.end.element,10)&&(d.element=parseInt(d.element,10)+1)),"delete"===a.end.section&&"delete"===d.element||(o[i][e]=d)}),0===o[i].length?delete o[i]:o[i]=A(o[i]))}),void(0===(o=A(o)).length?w.tmEPOAdmin.setFieldValue(i,n,l,"",t):(e.rules=o,w.tmEPOAdmin.setFieldValue(i,n,l,v.stringify(e),t))))},validate_rule:function(i,e,t){var n,a,l,o,d;return!k||!i||"object"!=typeof i||void 0===i.element||void 0===i.operator||void 0===i.section||void 0===i.value&&"isempty"!==i.operator&&"isnotempty"!==i.operator?[]:(o=w(".builder-layout").find(".builder-wrapper").eq(e),void 0!==t&&(o=o.find(".bitem").eq(t)),"product-properties"===i.section?(o.removeClass("tm-wrong-rule"),i):-1!==(n=y.findIndex(function(e){return e.section.sections_uniqid.default===i.section}))&&(void 0!==(n=y[n].fields.filter(function(e){var t=w.tmEPOAdmin.getFieldValue(e,"element_type");return"1"===w.tmEPOAdmin.getFieldValue(e,"enabled",t)||void 0===w.tmEPOAdmin.getFieldValue(e,"enabled",t)})[i.element])?(d=w.tmEPOAdmin.getFieldValue(n,"element_type"),a=!1,-1!==w.inArray(d,["radiobuttons","checkboxes","selectbox","selectboxmultiple"])?(l=w.tmEPOAdmin.getFieldMultiple(n,"value",d),Object.keys(l).some(function(e,t){return w.tmEPOAdmin.tm_escape(l[t].default)===i.value?a=!0:l[t].default===i.value&&(i.value=w.tmEPOAdmin.tm_escape(i.value),a=!0),a})):"variations"===d&&("is"===i.operator||"isnot"===i.operator)?w(k.variations).each(function(e,t){if(w.tmEPOAdmin.tm_escape(t.variation_id)===i.value)return!(a=!0)}):a=!0):a=!0,0<o.length)?a||void 0!==t&&""===w.tmEPOAdmin.getFieldValue(y[e].fields[t],"logic",d)?(o.removeClass("tm-wrong-rule"),i):(o.addClass("tm-wrong-rule"),[]):[])},logic_check_rules_reindex:function(l,e,o,t,d,s,r){var c;return void 0===(e="object"==typeof e&&null!==e?e:{}).toggle&&(e.toggle="show"),void 0===e.rules&&(e.rules=[]),e=w.tmEPOAdmin.convert_rules(e),c=w.epoAPI.util.deepCopyArray(e),o=parseInt(o,10),t=parseInt(t,10),s=parseInt(s,10),r=parseInt(r,10),w.each(e.rules,function(i,e){var n,a;Array.isArray(e)&&(w.each(e,function(e,t){n=t.section,a=t.element,n===d&&a.toString().isNumeric()&&(a=parseInt(a,10),o===a?r&&0===s?(delete c.rules[i][e],l.addClass("tm-wrong-rule")):1===s&&(a+=1,c.rules[i][e].element=a.toString()):o<a&&(0===s?(--a,c.rules[i][e].element=a.toString()):1===s&&(a+=1,c.rules[i][e].element=a.toString())))}),0===c.rules[i].length?delete c.rules[i]:c.rules[i]=A(c.rules[i]))}),c.rules=A(c.rules),c},logic_reindex:function(){var e=w.tmEPOAdmin.builderItemsSortableObj;e.start.section===e.end.section&&e.start.section_eq===e.end.section_eq&&e.start.element===e.end.element||(w.tmEPOAdmin.section_logic_reindex(),w.tmEPOAdmin.element_logic_reindex()),w.tmEPOAdmin.builderItemsSortableObj={start:{},end:{}}},logic_reindex_force:function(){w.tmEPOAdmin.builderItemsSortableObj.start.section="check",w.tmEPOAdmin.builderItemsSortableObj.start.section_eq="check",w.tmEPOAdmin.builderItemsSortableObj.start.element="check",w.tmEPOAdmin.builderItemsSortableObj.end.section="check2",w.tmEPOAdmin.builderItemsSortableObj.end.section_eq="check2",w.tmEPOAdmin.builderItemsSortableObj.end.element="check2",w.tmEPOAdmin.section_logic_reindex(),w.tmEPOAdmin.element_logic_reindex(),w.tmEPOAdmin.builderItemsSortableObj={start:{},end:{}}},builder_items_sortable:function(e){w.tmEPOAdmin.is_original&&(e=e.filter(function(){return!w(this).closest(".tma-nomove").length})).not(".tma-nomove").sortablejs({handle:".move",draggable:".bitem",onStart:function(e){var t,i,n,a,e=w(e.item);w.tmEPOAdmin.isElementDragged=!0,e.hasClass("ditem")?(w.tmEPOAdmin.builderItemsSortableObj.start.section="drag",w.tmEPOAdmin.builderItemsSortableObj.start.section_eq="drag",w.tmEPOAdmin.builderItemsSortableObj.start.element="drag"):((t=e.closest(".builder-wrapper")).addClass("has-drag"),t.closest(".builder-layout").addClass("has-drag"),a=t.index(),i=y[a].section.is_slider,n=w.tmEPOAdmin.find_index(i,e),e=w.tmEPOAdmin.find_index(i,e,".bitem",".element-is-disabled"),y[a].section.sections.default=parseInt(y[a].section.sections.default,10)-1,y[a].section.sections.default=y[a].section.sections.default.toString(),i&&(y[a].section.sections_slides.default=t.find(".bitem-wrapper").map(function(e,t){return w(t).children(".bitem").not(".sortable-ghost").length}).get().join(",")),w.tmEPOAdmin.builderItemsSortableObj.start.section=y[a].section.sections_uniqid.default,w.tmEPOAdmin.builderItemsSortableObj.start.section_eq=a.toString(),w.tmEPOAdmin.builderItemsSortableObj.start.element=n.toString(),w.tmEPOAdmin.builderItemsSortableObj.start.disabledFieldIndex=e),w(".builder-layout .bitem-wrapper").not(".tma-variations-wrap .bitem-wrapper").addClass("highlight")},onEnd:function(e){var t,i,n,a,l,o,e=w(e.item);w.tmEPOAdmin.isElementDragged=!1,t=e.closest(".builder-wrapper"),w(".builder-wrapper").removeClass("has-drag"),t.closest(".builder-layout").removeClass("has-drag"),o=t.index(),i=y[o].section.is_slider,n=w.tmEPOAdmin.find_index(i,e),a=w.tmEPOAdmin.find_index(i,e),l=w.tmEPOAdmin.find_index(i,e,".bitem",".element-is-disabled"),e.hasClass("ditem")||(w(".builder-wrapper.tm-zindex").css("zIndex","").removeClass("tm-zindex"),y[o].section.sections.default=parseInt(y[o].section.sections.default,10)+1,y[o].section.sections.default=y[o].section.sections.default.toString(),i&&(y[o].section.sections_slides.default=t.find(".bitem-wrapper").map(function(e,t){return w(t).children(".bitem").not(".sortable-ghost").length}).get().join(","))),w.tmEPOAdmin.builderItemsSortableObj.end.section=y[o].section.sections_uniqid.default,w.tmEPOAdmin.builderItemsSortableObj.end.section_eq=o.toString(),w.tmEPOAdmin.builderItemsSortableObj.end.element=a.toString(),w.tmEPOAdmin.builderItemsSortableObj.end.disabledFieldIndex=l,y[o].fields.splice(n,0,y[w.tmEPOAdmin.builderItemsSortableObj.start.section_eq].fields.splice(w.tmEPOAdmin.builderItemsSortableObj.start.element,1)[0]),w.tmEPOAdmin.builder_reorder_multiple(),w.tmEPOAdmin.logic_reindex(),w(".builder-layout .bitem-wrapper").removeClass("highlight")},forceFallback:!0,fallbackClass:"sortable-fallback",filter:".panels_wrap",group:"bitem"})},builder_delete_do:function(){var e,t,i,n,a,l,o,d,s=w(this);s.closest(".builder-layout").is(".builder-template")?w.tmEPOAdmin.builder_section_delete_do.apply(this):(l=(e=s.closest(".builder-wrapper")).index(),t=s.closest(".bitem"),i=y[l].section.is_slider,n=w.tmEPOAdmin.find_index(i,t),a=w.tmEPOAdmin.find_index(i,t,".bitem",".element-is-disabled"),y[l].section.sections.default=parseInt(y[l].section.sections.default,10)-1,y[l].section.sections.default=y[l].section.sections.default.toString(),d=y[l].fields[n],o=w.tmEPOAdmin.getFieldValue(d,"element_type"),d=void 0===w.tmEPOAdmin.getFieldValue(d,"enabled",o)||"1"===w.tmEPOAdmin.getFieldValue(d,"enabled",o),w.tmEPOAdmin.builderItemsSortableObj.start.section=y[l].section.sections_uniqid.default,w.tmEPOAdmin.builderItemsSortableObj.start.section_eq=l.toString(),w.tmEPOAdmin.builderItemsSortableObj.start.element=a.toString(),w.tmEPOAdmin.builderItemsSortableObj.end.section="delete",w.tmEPOAdmin.builderItemsSortableObj.end.section_eq="delete",w.tmEPOAdmin.builderItemsSortableObj.end.element="delete",d||(w.tmEPOAdmin.builderItemsSortableObj.start.disabled=!0,w.tmEPOAdmin.builderItemsSortableObj.start.disabledFieldIndex=w.tmEPOAdmin.find_index(i,s,".bitem",".element-is-disabled")),t.remove(),y[l].fields.splice(n,1),w.tmEPOAdmin.logic_reindex(),i&&(y[l].section.sections_slides.default=e.find(".bitem-wrapper").map(function(e,t){return w(t).children(".bitem").not(".pl2").length}).get().join(",")),w.tmEPOAdmin.builder_reorder_multiple())},builder_delete_onClick:function(e){e.preventDefault(),w(this).trigger("blur"),w.tmEPOAdmin.doConfirm(x.i18n_builder_delete,w.tmEPOAdmin.builder_delete_do,this)},builder_fold_onClick:function(){var e=w(this),t=(e=e.is(".tma-handle")?e.find(".fold"):e).closest(".tma-handle-wrap").find(".tma-handle-wrapper").first();e.data("folded")||void 0===e.data("folded")?(e.data("folded",!1),e.removeClass("tcfa-caret-up").addClass("tcfa-caret-down"),t.removeClass("tm-hidden")):(e.data("folded",!0),e.removeClass("tcfa-caret-down").addClass("tcfa-caret-up"),t.addClass("tm-hidden"))},builder_section_fold_onClick:function(){var e=w(this),t=e.closest(".builder-wrapper");e.data("folded")?(e.data("folded",!1),t.removeClass("tm-hide-bitems"),e.removeClass("tcfa-caret-up").addClass("tcfa-caret-down")):(e.data("folded",!0),t.addClass("tm-hide-bitems"),e.removeClass("tcfa-caret-down").addClass("tcfa-caret-up"))},builder_section_delete_do:function(){var e=w(this).closest(".builder-wrapper"),t=e.index();e.remove(),y.splice(t,1),w.tmEPOAdmin.builder_reorder_multiple(),w.tmEPOAdmin.section_logic_init(),w.tmEPOAdmin.initSectionsCheck()},builder_section_delete_onClick:function(e){e.preventDefault(),w(this).trigger("blur"),w.tmEPOAdmin.doConfirm(x.i18n_builder_delete,w.tmEPOAdmin.builder_section_delete_do,this)},builder_plus_onClick:function(){var e=w(this).parentsUntil(".bitem").parent().first(),t=e.attr("class").split(" ").filter(function(e){return 0===e.indexOf("w")})[0],i=Object.keys(w.tmEPOAdmin.builderSize),n=i.findIndex(function(e){return e===t}),i=i[n+1],n=w.tmEPOAdmin.builderSize[i];void 0!==i&&(e.css("--flex-width",n.replace("%","")),e.attr("data-size",n.replace("%","")),e.removeClass("flex-reset "+String(t)),e.addClass(String(i)).css("width",""),e.find(".size").text(n),n=e.closest(".builder-wrapper").index(),e=w.tmEPOAdmin.find_index(y[n].section.is_slider,e),w.tmEPOAdmin.setFieldValue(n,e,"div_size",i))},builder_minus_onClick:function(){var e=w(this).parentsUntil(".bitem").parent().first(),t=e.attr("class").split(" ").filter(function(e){return 0===e.indexOf("w")})[0],i=Object.keys(w.tmEPOAdmin.builderSize),n=i.findIndex(function(e){return e===t}),i=i[n-1],n=w.tmEPOAdmin.builderSize[i];void 0!==i&&(e.css("--flex-width",n.replace("%","")),e.attr("data-size",n.replace("%","")),e.removeClass("flex-reset "+String(t)),e.addClass(String(i)).css("width",""),e.find(".size").text(n),n=e.closest(".builder-wrapper").index(),e=w.tmEPOAdmin.find_index(y[n].section.is_slider,e),w.tmEPOAdmin.setFieldValue(n,e,"div_size",i))},builder_section_plus_onClick:function(){var e,t=w(this).closest(".builder-wrapper"),i=t.attr("class").split(" ").filter(function(e){return 0===e.indexOf("w")})[0],n=Object.keys(w.tmEPOAdmin.builderSize),a=n.findIndex(function(e){return e===i}),n=n[a+1],a=w.tmEPOAdmin.builderSize[n];void 0!==n&&(t.css("--flex-width",a.replace("%","")),t.attr("data-size",a.replace("%","")),t.removeClass("flex-reset "+String(i)),t.addClass(String(n)).css("width",""),t.find(".section-settings .size").text(a),e=t.index(),y[e].section.sections_size.default=n,y[e].size=a,w.tmEPOAdmin.makeResizables(t.find(".bitem")))},builder_section_minus_onClick:function(){var e,t=w(this).closest(".builder-wrapper"),i=t.attr("class").split(" ").filter(function(e){return 0===e.indexOf("w")})[0],n=Object.keys(w.tmEPOAdmin.builderSize),a=n.findIndex(function(e){return e===i}),n=n[a-1],a=w.tmEPOAdmin.builderSize[n];void 0!==n&&(t.css("--flex-width",a.replace("%","")),t.attr("data-size",a.replace("%","")),t.removeClass("flex-reset "+String(i)),t.addClass(String(n)).css("width",""),t.find(".section-settings .size").text(a),e=t.index(),y[e].section.sections_size.default=n,y[e].size=a,w.tmEPOAdmin.makeResizables(t.find(".bitem")))},builder_section_item_onClick:function(){var t,i,n,e=w.epoAPI.template.html(g.tc_builder_section,{}),a=w(this).closest(".builder-wrapper"),l=a.index(),e=w(e);e.addClass(y[l].section.sections_size.default),e.addClass("appear"),!0===y[l].section.tma_variations_wrap&&(e.find(".builder-remove-for-variations").remove(),e.find(".builder_hide_for_variation").hide(),e.find(".tma-tab-extra, .tma-tab-logic,.tma-tab-css,.tma-tab-woocommerce,.tma-tab-repeater").hide()),n=e.find(".section_elements"),w.tmEPOAdmin.copyContent(n,l),w.tmEPOAdmin.check_section_logic(l),t=w.tmEPOAdmin.sectionLogicObject,e=w.tmEPOAdmin.builder_floatbox_template({id:"tc-floatbox-content",html:"",title:x.i18n_edit_settings,uniqidtext:x.i18n_section_uniqid+":",uniqid:y[l].section.sections_uniqid.default}),w.tcFloatBox({closefadeouttime:0,animateOut:"",ismodal:!0,width:"80%",height:"80%",classname:"flasho tc-wrapper edit-section"+(a.is(".tma-variations-wrap")?" tma-variations-section":""),data:e,cancelEvent:function(e){i||(i=!0,w.tmEPOAdmin.sectionLogicObject=t,w.tmEPOAdmin.removeTinyMCE(".flasho.tc-wrapper"),e.destroy(),w("body").removeClass("floatbox-open"))},cancelClass:".floatbox-cancel",updateEvent:function(e){i||(i=!0,w.tmEPOAdmin.removeTinyMCE(".flasho.tc-wrapper"),w.tmEPOAdmin.changeBuilder(n,l),y[l].section.sections_logicrules.default=w.tmEPOAdmin.section_logic_get_JSON(n),w.tmEPOAdmin.sections_type_onChange(l),w.tmEPOAdmin.logic_reindex_force(),e.destroy(),w("body").removeClass("floatbox-open"))},updateClass:".floatbox-update"}),i=!1,w("body").addClass("floatbox-open"),n.appendTo("#tc-floatbox-content").removeClass("closed"),w.tmEPOAdmin.section_logic_init(l,n),setTimeout(function(){var e=n.find(".tm-builder-logicrules").val()||"null";e=w.epoAPI.util.parseJSON(e),e=w.tmEPOAdmin.logic_check_element_rules(e),n.find(".epo-rule-toggle").val(e.toggle)},1),w.tmEPOAdmin.set_fields_logic(n),n.find(".activate-sections-logic").trigger("change"),n.find(".tm-tabs").tmtabs({dataopenattribute:"data-tab"}),n.tmcheckboxes(),w.tmEPOAdmin.builder_clone_after_events(n),w.tcToolTip(w("#tc-floatbox-content").find(".tm-tooltip")),w.tmEPOAdmin.addTinyMCE(".flasho.tc-wrapper")},changeBuilder:function(e,t,i){var n,a,l,o=w.tmEPOAdmin.getFieldObject(e);void 0!==i?(n=w.tmEPOAdmin.getFieldValue(y[t].fields[i],"element_type"),a=y[t].fields[i].filter(function(e){return"element_type"===e.id||"div_size"===e.id||e.id===n+"_internal_name"}),y[t].fields[i]=[].concat.apply(a,o)):(a=[y[t].section.sections_internal_name],o=[].concat.apply(a,o),l={},Object.keys(o).forEach(function(e){l[o[e].id]=o[e]}),l.is_slider=y[t].section.is_slider,l.rules_toggle=y[t].section.rules_toggle,y[t].section=l)},copyContent:function(o,e,t){var d,s,r,c=o.find(".panels_wrap"),m=void 0!==t?y[e].fields[t]:y[e].section;Object.keys(m).forEach(function(n){var i,a,l;"object"==typeof m[n]&&("multiple"===m[n].id?Object.keys(m[n].multiple).forEach(function(t){0===(d=o.find(".options-wrap")).eq(t).length&&(d.eq(0).tcClone().removeClass("separator").appendTo(c).find(":input").not("button").val("").prop("checked",!1).find(".tc-option-enabled").prop("checked",!0).val("1").trigger("changechoice changednmpbq changefee"),(d=o.find(".options-wrap")).eq(t).find(".tc-cell-value input").addClass("tm_option_value")),l={title:!1,value:!1},Object.keys(m[n].multiple[t]).forEach(function(e){i=(i=(i=m[n].multiple[t][e].tags.name).replace("[]","")).substring(0,i.lastIndexOf("[")),a=m[n].multiple[t][e].default,(s=o.find(".options-wrap").eq(t).find("[name^='"+i+"']")).attr("data-builder",v.stringify(m[n].multiple[t][e])),s.attr("name",m[n].multiple[t][e].tags.name).attr("data-field-id",m[n].multiple[t][e].id).removeAttr("id").val(a).trigger("change"),void 0!==m[n].multiple[t][e].checked&&("multiple_checkboxes_options_default_value"===m[n].multiple[t][e].id||"multiple_radiobuttons_options_default_value"===m[n].multiple[t][e].id||"multiple_selectbox_options_default_value"===m[n].multiple[t][e].id||"multiple_selectboxmultiple_options_default_value"===m[n].multiple[t][e].id?s.val(t):s.val(m[n].multiple[t][e].tags.value),!0===m[n].multiple[t][e].checked?s.prop("checked",!0):s.prop("checked",!1)),"multiple_checkboxes_title_value"!==m[n].multiple[t][e].id&&"multiple_radiobuttons_title_value"!==m[n].multiple[t][e].id&&"multiple_selectbox_title_value"!==m[n].multiple[t][e].id||"-1"!==m[n].multiple[t][e].default||(l.title=!0),"multiple_checkboxes_options_value"!==m[n].multiple[t][e].id&&"multiple_radiobuttons_options_value"!==m[n].multiple[t][e].id&&"multiple_selectbox_options_value"!==m[n].multiple[t][e].id||"-1"!==m[n].multiple[t][e].default||(l.value=!0)}),l.value&&!l.title?((l=d.eq(t)).addClass("separator"),l.find(".tc-cell:not(.tc-cell-control,.tc-cell-title,.tc-cell-description)").addClass("tm-hidden"),l.find(".tm_option_value").removeClass("tm_option_value")):((l=d.eq(t)).removeClass("separator"),l.find(".tc-cell:not(.tc-cell-control,.tc-cell-title,.tc-cell-description)").removeClass("tm-hidden"),l.find(".tm_option_value").addClass("tm_option_value"))}):(i=m[n].tags.name,a=m[n].default,s=o.find("[name='"+w.epoAPI.util.escapeSelector(i)+"']"),"product"===m[n].fill&&m[n].options&&m[n].options.push&&(m[n].options.forEach(function(e){s.append(w('<option selected="selected" value="'+e.value+'">'+e.text+"</option>"))}),s.attr("data-exclude",x.original_post_id===x.post_id?x.post_id:x.post_id+","+x.original_post_id)),"category"===m[n].fill&&a&&a.push&&a.forEach(function(e){s.find('option[value="'+e+'"]').attr("selected","selected")}),s.is(".product-default-value-search")&&("products"===o.find(".product-mode:checked").val()||"product"===o.find(".product-mode:checked").val()?(s.removeClass("wc-product-search").addClass("enhanced-dropdown"),r=o.find(".product-products-selector").find(":selected").clone().prop("selected",!1).removeAttr("data-select2-id"),s.find("option").remove(),s.append(r)):""!==a&&(r=m[n].current_selected_text||a,s.attr("data-current-selected",a),s.data("current-selected-text",r),s.append(w('<option selected="selected" value="'+a+'">'+r+"</option>")),s.addClass("wc-product-search")),""!==a)&&s.attr("data-current-selected",a),s.attr("data-builder",v.stringify(m[n])).attr("data-field-id",m[n].id),s.is(":radio")?s.toArray().forEach(function(e,t){var i=m[n].options?(s.eq(t).val(m[n].options[t].value),m[n].options[t].value):s.eq(t).val();i===a?(s.eq(t).prop("checked",!0),s.eq(t).trigger("change")):s.eq(t).prop("checked",!1)}):(s.val(a).trigger("change"),void 0!==m[n].checked&&(s.val(m[n].tags.value),!0===m[n].checked?s.prop("checked",!0):s.prop("checked",!1))),m[n].disabled&&(s.addClass("tm-wmpl-disabled").prop("disabled",!0),s.closest(".message0x0").addClass("tc-setting-disabled"))))})},builder_uniqid_onClick:function(e){var t=w(this);e.ctrlKey&&(t.trigger("blur"),w.tmEPOAdmin.doConfirm({title:x.i18n_builder_change_uniqueid_title,html:x.i18n_builder_change_uniqueid+'<br><input type="text" class="t change-uniqueid" value="'+w(".tm-element-uniqid").attr("data-uniqid")+'" >',update:x.i18n_update,cancel:x.i18n_cancel},w.tmEPOAdmin.builder_uniqid_do,this,[w(this)],!0,!0))},builder_uniqid_do:function(){var e=w(".change-uniqueid").val(),t=w(".tm-builder-element-uniqid"),i=w(".tm-element-uniqid"),n=t.data("builder");t.val(e),n.default=e,t.attr("data-builder",v.stringify(n)),i.html(x.i18n_element_uniqid+":"+e),i.attr("data-uniqid",e)},builder_item_onClick:function(){var t,r,c,m,u=w(this).closest(".bitem"),e=w.epoAPI.template.html(g.tc_builder_elements,{}),p=u.closest(".builder-wrapper").index(),f=y[p].section.is_slider,_=w.tmEPOAdmin.find_index(f,u),h=w.tmEPOAdmin.getFieldValue(y[p].fields[_],"element_type"),e=w(e).filter(".bitem.element-"+h).tcClone(!0),b=w.tmEPOAdmin.getFieldValue(y[p].fields[_],"enabled",h);b="variations"===h||"1"===b||void 0===b?"1":"0",!0===y[p].section.tma_variations_wrap&&e.find("tma-tab-extra, .tma-tab-logic,.tma-tab-css,.tma-tab-woocommerce,.tma-tab-repeater").remove(),m=e.find(".builder-element-wrap:first"),"variations"===h&&m.find(".tm-all-attributes").html(y[p].variations_html),w.tmEPOAdmin.copyContent(m,p,_),w.tmEPOAdmin.check_element_logic(_,p),t=w.tmEPOAdmin.elementLogicObject,e=w.tmEPOAdmin.getFieldValue(y[p].fields[_],"uniqid",h),e=w.tmEPOAdmin.builder_floatbox_template({id:"tc-floatbox-content",html:"",title:x.i18n_edit_settings,uniqidtext:"variations"===h||void 0===e?"":x.i18n_element_uniqid+":",uniqid:"variations"===h||void 0===e?"":e}),w.tcFloatBox({closefadeouttime:0,animateOut:"",ismodal:!0,width:"80%",height:"80%",classname:"flasho tc-wrapper edit-element"+("variations"===h?" tma-variations-section":""),data:e,cancelEvent:function(e){r||(r=!0,(c=m.find(".tcpagination")).data("tc-pagination")&&c.tcPagination("destroy"),w.tmEPOAdmin.elementLogicObject=t,w.tmEPOAdmin.removeTinyMCE(".flasho.tc-wrapper"),e.destroy(),w("body").removeClass("floatbox-open"))},cancelClass:".floatbox-cancel",updateEvent:function(e){var i,n,a,l,o,d,s;r||(r=!0,(c=m.find(".tcpagination")).data("tc-pagination")&&c.tcPagination("destroy"),w.tmEPOAdmin.removeTinyMCE(".flasho.tc-wrapper"),w.tmEPOAdmin.changeBuilder(m,p,_),w.tmEPOAdmin.setFieldValue(p,_,"logicrules",w.tmEPOAdmin.element_logic_get_JSON(m),h),w.tmEPOAdmin.setFieldValue(p,_,"shipping_methods_enable_logicrules",w.tmEPOAdmin.element_shipping_logic_get_JSON(m,"enable"),h),w.tmEPOAdmin.setFieldValue(p,_,"shipping_methods_disable_logicrules",w.tmEPOAdmin.element_shipping_logic_get_JSON(m,"disable"),h),w.tmEPOAdmin.set_field_title(u,p,_),i="variations"===h||0===m.find(".is_enabled").length||m.find(".is_enabled").is(":checked")?"1":"0",n=0===m.find(".activate-element-logic").length||m.find(".activate-element-logic").is(":checked")?"1":"0","0"==i?u.addClass("element-is-disabled"):u.removeClass("element-is-disabled"),b!=i&&(a=y[p].section.sections_uniqid.default,l=_,o=w.tmEPOAdmin.find_index(f,u,".bitem",".element-is-disabled"),Object.keys(y[p].fields).forEach(function(e){d=w.tmEPOAdmin.getFieldValue(y[p].fields[e],"logicrules",!0)||"null",d=w.epoAPI.util.parseJSON(d),d=w.tmEPOAdmin.logic_check_rules_reindex(u,d,l,o,a,i,n),w.tmEPOAdmin.setFieldValue(p,e,"logicrules",v.stringify(d),!0)}),Object.keys(y).forEach(function(t){(t=parseInt(t,10))!==p&&(s=y[t].section.sections_logicrules.default||"null",s=w.epoAPI.util.parseJSON(s),s=w.tmEPOAdmin.logic_check_rules_reindex(w(".builder-wrapper").eq(t),s,l,o,a,i,n),y[t].section.sections_logicrules.default=v.stringify(s),Object.keys(y[t].fields).forEach(function(e){d=w.tmEPOAdmin.getFieldValue(y[t].fields[e],"logicrules",!0)||"null",d=w.epoAPI.util.parseJSON(d),d=w.tmEPOAdmin.logic_check_rules_reindex(w(".builder-wrapper").eq(t).find(".bitem").eq(e),d,l,o,a,i,n),w.tmEPOAdmin.setFieldValue(t,e,"logicrules",v.stringify(d),!0)}))})),w.tmEPOAdmin.logic_reindex_force(),e.destroy(),w("body").removeClass("floatbox-open"))},updateClass:".floatbox-update"}),r=!1,w("body").addClass("floatbox-open"),m.appendTo("#tc-floatbox-content"),w("#tc-floatbox-content").find(".builder-element-wrap").addClass("tm-hidden").after(w('<div class="floatbox-loading">'+x.i18n_loading+"</div>")),setTimeout(function(){var e;w.tmEPOAdmin.element_logic_init(_,p,m),m.find(".activate-element-logic").trigger("change"),m.find(".tc-option-enabled").trigger("changechoice"),m.find(".tc-cell-dnmpbq .c").trigger("changednmpbq"),m.find(".tc-cell-fee .c").trigger("changefee"),e=m.find(".tm-builder-logicrules").val()||"null",e=w.epoAPI.util.parseJSON(e),e=w.tmEPOAdmin.logic_check_element_rules(e),m.find(".epo-rule-toggle").val(e.toggle),m.find(":radio:checked").not(".panels_wrap :radio").trigger("change"),"variations"===h&&(m.find(".builder-remove-for-variations").remove(),m.find(".builder_hide_for_variation").hide()),m.tmcheckboxes(),w.tmEPOAdmin.builder_clone_after_events(m),"variations"===h?w.tmEPOAdmin.variations_display_as():w.tmEPOAdmin.floatbox_content_js(),w.tmEPOAdmin.set_fields_logic(m),w.tcToolTip(w("#tc-floatbox-content").find(".tm-tooltip")),w.tmEPOAdmin.tm_weekdays(w("#tc-floatbox-content")),w.tmEPOAdmin.tm_months(w("#tc-floatbox-content")),w.tmEPOAdmin.tm_url(),w.tmEPOAdmin.tm_pricetype_selector(),w.tmEPOAdmin.dynamicMode(),w.tmEPOAdmin.tm_option_price_type(),w.tmEPOAdmin.addTinyMCE(".flasho.tc-wrapper"),w.tmEPOAdmin.paginattion_init(),w("#tc-floatbox-content").find(".builder-element-wrap").removeClass("tm-hidden"),m.find(".tm-tabs").tmtabs({dataopenattribute:"data-tab"}),w("#tc-floatbox-content").find(".floatbox-loading").remove()},1)},set_fields_logic:function(c){c.find(".message0x0[data-required]").toArray().forEach(function(d){var s,t,r="AND";d=w(d),(s=d.data("required")).relation&&(r=s.relation,delete s.relation),t=function(){var o=!0;Object.keys(s).some(function(e){var t,i,n,a=s[e].operator,l=s[e].value;return(o=(o="OR"===r?!0:o)&&(t=w(e),i="",n=!1,c.find(e).length?(t.is(":checkbox")?t.is(":checked")&&(i=t.val()):i=(t.is(":radio")?c.find(e).filter(":checked"):t).val(),n="object"==typeof l?-1!==w.inArray(i,l):i===l,(n="is"===a?n:!n)?d.removeClass("tm-hidden"):d.addClass("tm-hidden"),n):!!("is"===a&&(""===l||Array.isArray(l)&&l.includes(""))||"isnot"===a&&(""!==l||Array.isArray(l)&&!l.includes("")))||n))||d.addClass("tm-hidden"),"OR"===r&&o})},Object.keys(s).forEach(function(e){c.on("change.required changerequired",e,t)}),t()})},getFieldObject:function(e){var i,n,a,l,o,d,t=[];return e.find(":input").not("button").not(".panels_wrap :input").toArray().forEach(function(e){(e=w(e)).is(":radio")&&!e.is(":checked")||void 0!==(i=e.attr("name"))&&0===i.indexOf("tm_meta[")&&((n=i.split(/[[\]]{1,2}/)).pop(),n=n.map(function(e){return""===e?null:e}).filter(function(e){return null!=e?e:null}).splice(2,1)[0],o={id:n,default:e.val(),type:e.prop("nodeName").toLowerCase(),tags:{name:i}},(e.is(":checkbox")||e.is(":radio"))&&(o.checked=e.is(":checked"),o.tags.value=e.attr("value"),o.checked?o.default=e.attr("value"):o.default=""),e.is(".product-categories-selector")?(o.fill="category",o.options=[]):e.is(".product-products-selector")&&(o.fill="product",o.options=[]),e.attr("data-builder")&&(("product"===(d=w.epoAPI.util.parseJSON(e.attr("data-builder"))).fill||"category"===d.fill||e.is(".product-products-selector")||e.is(".product-categories-selector"))&&(o.options=e.find("option:selected").toArray().map(function(e){return{text:w(e).text(),value:w(e).val()}})),d)&&(o=Object.assign(d,o)),e.attr("data-current-selected")&&(o.current_selected=e.attr("data-current-selected"),o.current_selected_text=e.data("current-selected-text")),t.push(o))}),0<e.find(".panels_wrap :input").not("button").length&&(a=[],e.find(".panels_wrap .options-wrap").each(function(e,t){l=[],w(t).find(":input").not("button").each(function(e,t){t=w(t),void 0!==(i=t.attr("name"))&&0===i.indexOf("tm_meta[")&&((n=i.split(/[[\]]{1,2}/)).pop(),n=n.map(function(e){return""===e?null:e}).filter(function(e){return null!=e?e:null}).splice(2,1)[0],o={id:n,default:t.val(),type:t.prop("nodeName").toLowerCase(),tags:{name:i}},(t.is(":checkbox")||t.is(":radio"))&&(o.checked=t.is(":checked"),o.tags.value=t.attr("value"),o.checked?o.default=t.attr("value"):o.default=""),t.attr("data-builder")&&(d=w.epoAPI.util.parseJSON(t.attr("data-builder")))&&(o=Object.assign(d,o)),l.push(o))}),a.push(l)}),t.push({id:"multiple",multiple:a})),t},builder_clone_element:function(l,e,t,i,n){var a,o,d,s,r,c,m=w.epoAPI.template.html(g.tc_builder_elements,{});if(m)return t=t||"append",e=w(e),(m=w(m).filter(".bitem.element-"+l).tcClone(!0))?(s=e.index(),a=y[s].section.is_slider,"replace"===t&&i&&n?(c=i.find(".tm-for-bitem").attr("data-element"),m.find(".tm-builder-element-uniqid").val(w.tmEPOAdmin.getFieldValue(y[s].fields[w.tmEPOAdmin.find_index(a,i)],"uniqid",c))):m.find(".tm-builder-element-uniqid").val(w.epoAPI.math.uniqueid("",!0)),w(".builder-wrapper").length<=0&&(w.tmEPOAdmin.builder_add_section_onClick(),e=w(".builder-wrapper").first()),r=w.tmEPOAdmin.getFieldObject(m),"replace"===t&&i&&n?i.replaceWith(m):0<e.find(".bitem-wrapper").find(".ditem").length?e.find(".bitem-wrapper").find(".ditem").replaceWith(m):("append"===t&&e.find(".bitem-wrapper").not(".tm-hide").append(m),"prepend"===t&&e.find(".bitem-wrapper").not(".tm-hide").prepend(m),y[s].section.sections.default=parseInt(y[s].section.sections.default,10)+1,y[s].section.sections.default=y[s].section.sections.default.toString()),o=w.tmEPOAdmin.find_index(a,m),d=w.tmEPOAdmin.find_index(a,m,".bitem",".element-is-disabled"),"replace"===t&&i&&n?"yes"===n?(i=r.map(function(a){var e={},t=y[s].fields[o].find(function(e){var t="div_size"===e.id||"element_type"===e.id||"multiple"===e.id?e.id:l+e.id.slice(c.length);return"header"===c&&["header_size","header_title","header_title_position","header_title_color","header_subtitle","header_subtitle_color","header_subtitle_position"].includes(e.id)?t=l+"_"+e.id:"header"===l&&t.toString().startsWith(l+"_header")&&(t=e.id.slice(l.length-1)),"element_type"!==a.id&&a.id!==l+"_internal_name"&&t===a.id});return t?(Object.keys(a).forEach(function(n){"id"!==n&&"tags"!==n&&t.hasOwnProperty(n)?"multiple"===n?(e[n]=t[n].map(function(e){return e.map(function(e){var t=e.id.replace("_"+c+"_","_"+l+"_"),i=a[n][0].find(function(e){return e.id===t});return i&&e.tags&&(e.tags.name&&(e.tags.name=e.tags.name.replace("_"+c+"_","_"+l+"_")),e.tags.id&&(e.tags.id=e.tags.id.replace("_"+c+"_","_"+l+"_")),t.endsWith("options_default_value"))&&("radiobuttons"===c&&"checkboxes"===l?(e.type="input",e.tags.name=e.tags.name+"[]"):"checkboxes"===c&&"radiobuttons"===l&&(e.type="radio",e.tags.name=e.tags.name.slice(0,-2))),i?Object.assign({},e,{id:t}):null})}),e[n]=e[n].map(function(e){return e.filter(function(e){return null!==e})})):e[n]=t[n]:e[n]=a[n]}),e):a}),y[s].fields[o]=i,void 0===(n=w.tmEPOAdmin.getFieldValue(y[s].fields[o],"header"===l?"title":"header_title",l))||""===n?m.find(".tm-label").html(x.i18n_no_title):m.find(".tm-label").html(n),n=m.attr("class").split(" ").filter(function(e){return 0===e.indexOf("w")})[0],m.removeClass(String(n)),(n=i.find(function(e){return"div_size"===e.id}))&&(n=n.default,m.addClass(n),i=String(n).replace("-",".").replace("w",""),m.attr("data-size",i),m.find(".bitem-setting.size").text(i+"%"))):y[s].fields[o]=r:"prepend"!==t&&"append"!==t||(a&&(y[s].section.sections_slides.default=e.find(".bitem-wrapper").map(function(e,t){return w(t).children(".bitem").not(".pl2").length}).get().join(",")),w.tmEPOAdmin.builderItemsSortableObj.start.section="drag",w.tmEPOAdmin.builderItemsSortableObj.start.section_eq="drag",w.tmEPOAdmin.builderItemsSortableObj.start.element="drag",w.tmEPOAdmin.builderItemsSortableObj.end.section=y[s].section.sections_uniqid.default,w.tmEPOAdmin.builderItemsSortableObj.end.section_eq=e.index().toString(),w.tmEPOAdmin.builderItemsSortableObj.end.element=d.toString(),y[s].fields.splice(o,0,r)),m.find(".builder-element-wrap").empty(),m.find(".builder_element_type").remove(),m.find(".div_size").remove(),m.find(".tm-internal-name").remove(),w.tmEPOAdmin.check_element_logic(m),w.tmEPOAdmin.builder_reorder_multiple(),w.tmEPOAdmin.makeResizables(m),m):void 0},doConfirm:function(e,t,i,n,a,l){var o="object"==typeof e&&null!==e?e.title:e,d="object"==typeof e&&null!==e&&e.html?'<div class="tm-inner">'+e.html+"</div>":"",o=w.epoAPI.template.html(_.template(e.template||"tc-floatbox"),{id:"tc-floatbox-content",title:o,html:d,uniqid:"",update:"object"==typeof e&&null!==e&&void 0!==e.update?e.update:x.i18n_yes,cancel:"object"==typeof e&&null!==e&&void 0!==e.cancel?e.cancel:x.i18n_no}),s=!1;return w.tcFloatBox({closefadeouttime:0,overlayopacity:.6,animateOut:"",classname:"flasho tc-wrapper"+(d?"":" tc-question"),data:o,cancelEvent:function(e){s||(s=!0,e.destroy(),a&&(n.push("no"),t.apply(i,n)))},cancelClass:".floatbox-cancel",updateEvent:function(e){s||(s=!0,a&&n.push("yes"),l?(t.apply(i,n),e.destroy()):(e.destroy(),t.apply(i,n)))},updateClass:".floatbox-update",isconfirm:!0,unique:!0})},builder_clone_do:function(){var e,t,i,n,a=w(this).closest(".bitem"),l=a.data("original_title"),o=a.tcClone();o.data("original_title",l),o&&(a.after(o),n=(l=o.closest(".builder-wrapper")).index(),i=y[n].section.is_slider,e=w.tmEPOAdmin.find_index(i,o),t=w.tmEPOAdmin.find_index(i,o,".bitem",".element-is-disabled"),y[n].section.sections.default=parseInt(y[n].section.sections.default,10)+1,y[n].section.sections.default=y[n].section.sections.default.toString(),i&&(y[n].section.sections_slides.default=l.find(".bitem-wrapper").map(function(e,t){return w(t).children(".bitem").not(".pl2").length}).get().join(",")),i=w.tmEPOAdmin.find_index(a,a),y[n].fields.splice(i,0,w.epoAPI.util.deepCopyArray(y[n].fields[i])),w.tmEPOAdmin.setFieldValue(n,e,"uniqid",w.epoAPI.math.uniqueid("",!0),!0),w.tmEPOAdmin.builder_reorder_multiple(),w.tmEPOAdmin.builderItemsSortableObj.start.section="clone",w.tmEPOAdmin.builderItemsSortableObj.start.section_eq="clone",w.tmEPOAdmin.builderItemsSortableObj.start.element="clone",w.tmEPOAdmin.builderItemsSortableObj.end.section=y[n].section.sections_uniqid.default,w.tmEPOAdmin.builderItemsSortableObj.end.section_eq=n.toString(),w.tmEPOAdmin.builderItemsSortableObj.end.element=t.toString(),w.tmEPOAdmin.logic_reindex(),w.tmEPOAdmin.makeResizables(o))},builder_clone_onClick:function(e){e.preventDefault(),w.tmEPOAdmin.doConfirm(x.i18n_builder_clone,w.tmEPOAdmin.builder_clone_do,this,[w(this)])},builder_change_do:function(n,a){var e=w.tmEPOAdmin.builder_floatbox_template_import({id:"tc-floatbox-content",html:'<div class="tm-inner">'+x.element_data+"</div>",title:x.i18n_change_element}),l=w.tcFloatBox({closefadeouttime:0,animateOut:"",ismodal:!1,width:"70%",height:"70%",classname:"flasho tc-wrapper tc-builder-add-element",data:e}),o=n.closest(".bitem"),e=o.find(".tm-for-bitem").attr("data-element");w(".tm-elements-container").find(".element-"+e).closest(".tm-element-button").remove(),w(".tc-builder-add-element .tc-element-button").on("click.cpf",function(e){var t=n.closest(".builder-wrapper"),i=w(this).attr("data-element");e.preventDefault(),w.tmEPOAdmin.builder_clone_element(i,t,"replace",o,a),w.tmEPOAdmin.logic_reindex(),l.destroy()})},builder_change_onClick:function(e){e.preventDefault(),w.tmEPOAdmin.doConfirm({title:x.i18n_builder_change_ask_title,html:x.i18n_builder_change_ask},w.tmEPOAdmin.builder_change_do,this,[w(this)],!0)},builder_section_clone_do:function(){var i,e,t=w(this).closest(".builder-wrapper"),n=t.tcClone();n&&(e=t.index(),i=[],t.find(".bitem").each(function(e,t){i[e]=w(t).data("original_title")}),t.after(n),t=t.index(),y.splice(e,0,w.epoAPI.util.deepCopyArray(y[e])),y[t].section.sections_uniqid.default=w.epoAPI.math.uniqueid("",!0),n.find(".bitem").each(function(e,t){w(t).data("original_title",i[e])}),y[t].section.is_slider&&w.tmEPOAdmin.createSlider(n),w.tmEPOAdmin.builder_reorder_multiple(),w.tmEPOAdmin.builder_items_sortable(n.find(".bitem-wrapper")),w.tmEPOAdmin.check_section_logic(t),w.tmEPOAdmin.check_element_logic(),w.tmEPOAdmin.section_logic_init(t),w.tmEPOAdmin.makeResizables(n),w.tmEPOAdmin.makeResizables(n.find(".bitem")))},builder_section_clone_onClick:function(e){e.preventDefault(),w.tmEPOAdmin.doConfirm(x.i18n_builder_clone,w.tmEPOAdmin.builder_section_clone_do,this,[w(this)])},builder_floatbox_template:function(e,t){return w.epoAPI.template.html(_.template(t||"tc-floatbox"),{id:e.id,title:e.title,html:e.html,uniqidtext:e.uniqidtext||"",uniqid:e.uniqid,update:e.update||x.i18n_update,cancel:e.cancel||x.i18n_cancel})},builder_floatbox_template_import:function(e){return w.epoAPI.template.html(_.template("tc-floatbox-import"),{id:e.id,title:e.title,html:e.html,cancel:x.i18n_cancel})},nameChange:function(e,t){var i=/\[[0-9]+\]\[\]/g,n=/\[[0-9]+\]/g;return null!==e.match(i)?e=e.replace(i,"["+t+"][]"):null!==e.match(n)&&(e=e.replace(n,"["+t+"]")),e},builder_reorder_multiple:function(){[].concat.apply([],y.map(function(e){return e.fields.map(function(e){return e.map(function(e){return"element_type"===e.id?e.default:null}).filter(function(e){return null!==e})[0]})})).filter(function(e,t,i){return i.indexOf(e)===t}).forEach(function(t){var o=0;y.map(function(e){return e.fields.map(function(e){return e.find(function(e){return"element_type"===e.id&&e.default===t})?e:null})}).forEach(function(e,l){e.forEach(function(e,n){var a;e&&(void 0!==(e=e.find(function(e,t){return"multiple"===e.id&&(a=t),"multiple"===e.id}))&&"object"==typeof e&&(e=e.multiple).forEach(function(e,i){e.forEach(function(e,t){y[l].fields[n][a].multiple[i][t].tags.name=w.tmEPOAdmin.nameChange(y[l].fields[n][a].multiple[i][t].tags.name,o)})}),o+=1)})})})},getEnhancedSelectFormatString:function(){return{language:{errorLoading:function(){return n.i18n_searching},inputTooLong:function(e){e=e.input.length-e.maximum;return 1==e?n.i18n_input_too_long_1:n.i18n_input_too_long_n.replace("%qty%",e)},inputTooShort:function(e){e=e.minimum-e.input.length;return 1==e?n.i18n_input_too_short_1:n.i18n_input_too_short_n.replace("%qty%",e)},loadingMore:function(){return n.i18n_load_more},maximumSelected:function(e){return 1===e.maximum?n.i18n_selection_too_long_1:n.i18n_selection_too_long_n.replace("%qty%",e.maximum)},noResults:function(){return n.i18n_no_matches},searching:function(){return n.i18n_searching}}}},create_products_search:function(e){e.find(":input.wc-product-search").filter(":not(.enhanced)").each(function(){var t,e,i={allowClear:!0,placeholder:w(this).data("placeholder"),dropdownCssClass:"tc-dropdown",minimumInputLength:w(this).data("minimum_input_length")?w(this).data("minimum_input_length"):"3",escapeMarkup:function(e){return e},ajax:{url:n.ajax_url,dataType:"json",delay:250,data:function(e){return{term:e.term,action:w(this).data("action")||"woocommerce_json_search_products_and_variations",security:n.search_products_nonce,exclude:w(this).data("exclude"),include:w(this).data("include"),limit:w(this).data("limit"),display_stock:w(this).data("display_stock"),tcmode:"builder"}},processResults:function(e){var i=[];return e&&w.each(e,function(e,t){i.push({id:e,text:t})}),{results:i}},cache:!0}},i=w.extend(i,w.tmEPOAdmin.getEnhancedSelectFormatString());w(this).selectWoo(i).addClass("enhanced"),w(this).on("select2:open",function(){var e=w(r).scrollTop();w(r).scrollTop(e+1),w(r).scrollTop(e)}),w(this).data("sortable")?(t=w(this),(e=w(this).next(".select2-container").find("ul.select2-selection__rendered")).sortablejs({forceFallback:!0,fallbackClass:"sortable-fallback",draggable:"li:not(.select2-search__field)",handle:"li:not(.select2-search__field)",onEnd:function(){w(e.find(".select2-selection__choice").get().reverse()).each(function(){var e=w(this).data("data").id,e=t.find('option[value="'+e+'"]')[0];t.prepend(e)})}})):w(this).prop("multiple")&&w(this).on("change",function(){var e=w(this).children();e.sort(function(e,t){e=e.text.toLowerCase(),t=t.text.toLowerCase();return t<e?1:e<t?-1:0}),w(this).html(e)})})},create_categories_search:function(e){e.find(":input.wc-category-search").filter(":not(.enhanced)").each(function(){var e=w.extend({allowClear:!0,placeholder:w(this).data("placeholder"),dropdownCssClass:"tc-dropdown"},w.tmEPOAdmin.getEnhancedSelectFormatString());w(this).selectWoo(e).addClass("enhanced"),w(this).on("select2:open",function(){var e=w(r).scrollTop();w(r).scrollTop(e+1),w(r).scrollTop(e)})})},create_enhanced_dropdown:function(e){e.find(":input.enhanced-dropdown").filter(":not(.enhanced)").each(function(){var e={allowClear:!0,placeholder:w(this).data("placeholder"),dropdownCssClass:"tc-dropdown"},e=w.extend(e,w.tmEPOAdmin.getEnhancedSelectFormatString());w(this).selectWoo(e).addClass("enhanced")})},create_normal_dropdown:function(e){e.find("select").filter(":not(.enhanced, .enhanced-dropdown, .wc-category-search, .wc-product-search)").not(".shipping-logic-div select, .builder-logic-div select, .panels_wrap select, .options-wrap select").each(function(){var e={allowClear:!!w(this).is(".wc-template-search"),minimumResultsForSearch:w(this).is(".wc-template-search")?0:-1,dropdownCssClass:"tc-dropdown"},e=w.extend(e,w.tmEPOAdmin.getEnhancedSelectFormatString());w(this).selectWoo(e).addClass("enhanced")})},builder_clone_elements_after_events:function(e){e.find("input.tm-color-picker").spectrum("destroy"),e.find(".sp-replacer").remove(),e.find("input.tm-color-picker").spectrum({showInput:!0,showInitial:!0,allowEmpty:!0,showAlpha:!1,showPalette:!1,preferredFormat:"hex",theme:"epo",showButtons:!0,clickoutFiresChange:!1,chooseText:x.i18n_update,cancelText:x.i18n_cancel,clearText:""})},builder_clone_after_events:function(e){w.tmEPOAdmin.builder_clone_elements_after_events(e),w.tmEPOAdmin.panelsSortable(e.find(".panels_wrap")),w.tmEPOAdmin.create_normal_dropdown(e),w.tmEPOAdmin.create_enhanced_dropdown(e),w.tmEPOAdmin.create_products_search(e),w.tmEPOAdmin.create_categories_search(e)},paginattion_init:function(e){var i,n,t=w("#tc-floatbox-content"),a=t.find(".tcpagination");0===a.length||x.tcAdminNoPagination||(t=t.find(".panels_wrap"),i=t.find(".options-wrap"),n=parseInt(a.attr("data-perpage"),10),t=Math.ceil(i.length/n),a.data("tc-pagination")&&a.tcPagination("destroy"),e="last"===e?t:"current"===e&&a.data("pagination_current")||1,a.data("pagination_current",e),a.tcPagination({totalPages:t,startPage:e,visiblePages:10,onPageClick:function(e,t){w.tmEPOAdmin.paginationOnClick(a,t,n,i)}}))},paginationOnClick:function(e,t,i,n){t=parseInt(t,10),e.data("pagination_current",t),n.addClass("tm-hidden"),n.filter(function(e){return i*(t-1)<=e&&e<=i*t-1}).removeClass("tm-hidden")},addTinyMCE:function(e){var i,a,n,l,o,t="excerpt",d="object"==typeof m&&void 0!==m.mceInit&&t in m.mceInit?m.mceInit[t]:{theme:"modern",menubar:!1,wpautop:!0,indent:!1,toolbar1:"bold,italic,underline,blockquote,strikethrough,bullist,numlist,alignleft,aligncenter,alignright,undo,redo,link,unlink",plugins:"fullscreen,image,wordpress,wpeditimage,wplink"},s="object"==typeof m&&void 0!==m.qtInit&&t in m.mceInit?m.qtInit[t]:{buttons:"strong,em,link,block,del,ins,img,ul,ol,li,code,more,close,fullscreen"};w(e)&&void 0!==f&&(l=w("#wp-"+t+"-editor-tools").html(),o=w("#wp-"+t+"-editor-tools").attr("class"),w(e).find("textarea").not(":disabled").not(".tm-no-editor").each(function(e,t){(a=w(t).attr("id"))||(w(t).attr("id",w(t).attr("name").replace(/[[\]]/g,"")),a=w(t).attr("id")),a&&(i=w.extend({},d,{selector:"#"+a}),n=w.extend({},s,{id:a}),"object"==typeof m&&(m.mceInit[a]=i,m.qtInit[a]=n),w(t).addClass("wp-editor-area").wrap('<div id="wp-'+a+'-wrap" class="wp-core-ui wp-editor-wrap tmce-active tm_editor_wrap"></div>').before('<div class="'+o+'">'+l+"</div>").wrap('<div class="wp-editor-container"></div>'),w(".tm_editor_wrap").find(".wp-switch-editor").each(function(e,t){var i,n;w(t).attr("id")&&(i=(n=w(t).attr("id")).length,n=n.substring(i-4),w(t).attr("id",a+"-"+n),w(t).attr("data-wp-editor-id",a))}),w(".tm_editor_wrap").find(".insert-media").attr("data-editor",a),f.init(i),u&&p&&(p(n),u._buttonsInit()),w(t).closest(".tm_editor_wrap").find("a.insert-media").data("editor",a).attr("data-editor",a))}))},removeTinyMCE:function(e){var i,n,a,l="";w(e)&&void 0!==f&&w(e).find("textarea").not(":disabled").not(".tm-no-editor").each(function(e,t){(i=w(t).attr("id"))&&f&&f.editors&&(n=w(t).val(),a=void 0!==f&&f.editors[i]&&!f.editors[i].isHidden(),void 0!==f.editors[i]&&(l=f.editors[i].getContent(),f.editors[i].remove()),w(t).closest(".tm_editor_wrap").find(".quicktags-toolbar,.wp-editor-tools").remove(),w(t).unwrap().unwrap(),a?""===l?w(t).val(""):w(t).val(l):w(t).val(n))})},set_field_title:function(e,t,i){var n;0!==e.length&&(n=w.tmEPOAdmin.getFieldValue(y[t].fields[i],"element_type"),void 0===(t=w.tmEPOAdmin.getFieldValue(y[t].fields[i],"header_title","header"!==n))||""===t?e.find(".tm-label").html(x.i18n_no_title):e.find(".tm-label").html(t))},variations_display_as:function(e){var n,a,l,e=e?w(this).is(".tm-changes-product-image")?w(this).closest(".tm-attribute").find(".variations-display-as"):w(this):w("#tc-floatbox-content .variations-display-as");e.each(function(e,t){var i;n=w(t).closest(".tm-attribute"),a=n.find(".tm-term"),l=n.find(".tm-changes-product-image"),"select"===(i=w(t).val())?n.find(".tma-hide-for-select-box").hide().addClass("tc-row-hidden"):n.find(".tma-hide-for-select-box").show().removeClass("tc-row-hidden"),"image"===i||"color"===i||"radiostart"===i||"radioend"===i?n.find(".tma-show-for-swatches").show().removeClass("tc-row-hidden"):n.find(".tma-show-for-swatches").hide().addClass("tc-row-hidden"),a.each(function(e,t){switch(w(t).hide().find(".tma-term-color,.tma-term-image,.tma-term-custom-image").hide(),i){case"select":case"radio":"images"===l.val()&&l.val(""),l.children("option[value='images']").attr("disabled","disabled").hide(),"custom"===l.val()&&w(t).show().find(".tma-term-custom-image").show();break;case"image":case"radiostart":case"radioend":l.children("option[value='images']").prop("disabled",!1).show(),w(t).show().find(".tma-term-image").show(),"custom"===l.val()&&w(t).show().find(".tma-term-custom-image").show();break;case"color":"images"===l.val()&&l.val(""),l.children("option[value='images']").attr("disabled","disabled").hide(),"custom"===l.val()&&w(t).show().find(".tma-term-custom-image").show(),w(t).show().find(".tma-term-color").show()}})}),(e=w("#tc-floatbox-content")).find(".tm_option_image").each(function(){var e=w(this),t=e.closest(".tc-upload-image-wrap");""!==e.val()&&(e.addClass("has-image"),t.addClass("has-image")),t.find(".tm_upload_image_img").attr("src",w(this).val()||O)})},floatbox_content_js:function(){var e,t,i,n=w("#tc-floatbox-content"),a=n.find(".replacement-mode:checked"),l=n.find(".tm-changes-product-image"),o=n.find(".show-tooltip"),d=n.find(".builder-element-wrap").find(".tc-upload-image-wrap.swatch"),s=n.find(".builder-element-wrap").find(".tc-upload-image-wrap.swatch-hover"),r=n.find(".builder-element-wrap").find(".tc-upload-image-wrap.product-image"),c=n.find(".builder-element-wrap").find(".tc-upload-image-wrap.lightbox"),m=n.find(".builder-element-wrap").find(".tc-cell-images"),u=n.find(".builder-element-wrap .panels_wrap").find(".tc-upload-image-wrap.color");d.hide(),s.hide(),r.hide(),c.hide(),m.hide(),u.hide(),"images"!==l.val()||"none"!==a.val()&&"text"!==a.val()||(e=n.find(".tm_option_image").not(".tm_option_imagep"),t=n.find(".tm_option_imagep"),i=n.find(".tm_upload_imagep .tm_upload_image_img"),l.val("custom"),e.each(function(e){t.eq(e).val(w(this).val()),i.attr("src",w(this).val()||O)})),a.length&&"image"===a.val()?l.find("option[value='images']").prop("disabled",!1).show():("images"===l.val()&&l.val(""),l.find("option[value='images']").attr("disabled","disabled").hide()),setTimeout(function(){l.selectWoo("destroy").removeClass("enhanced"),w.tmEPOAdmin.create_normal_dropdown(l.parent()),l.trigger("change.select2")},100),("image"===a.val()||"images"===a.val()&&"images"===l.val())&&(d.show(),s.show(),m.show()),"custom"===l.val()&&(r.show(),m.show()),"image"===a.val()&&w("#tc-floatbox-content .tm-use-lightbox").is(":checked")&&c.show(),"color"===a.val()||"text"===a.val()?("swatch_img"!==o.val()&&"swatch_img_lbl"!==o.val()&&"swatch_img_desc"!==o.val()&&"swatch_img_lbl_desc"!==o.val()||o.val(""),o.find("option[value='swatch_img']").attr("disabled","disabled").hide(),o.find("option[value='swatch_img_lbl']").attr("disabled","disabled").hide(),o.find("option[value='swatch_img_desc']").attr("disabled","disabled").hide(),o.find("option[value='swatch_img_lbl_desc']").attr("disabled","disabled").hide()):(o.find("option[value='swatch_img']").prop("disabled",!1).show(),o.find("option[value='swatch_img_lbl']").prop("disabled",!1).show(),o.find("option[value='swatch_img_desc']").prop("disabled",!1).show(),o.find("option[value='swatch_img_lbl_desc']").prop("disabled",!1).show()),setTimeout(function(){o.selectWoo("destroy").removeClass("enhanced"),w.tmEPOAdmin.create_normal_dropdown(o.parent()),o.trigger("change.select2")},100),"color"===a.val()&&(m.show(),u.show()),n.find(".tc-option-image").each(function(e){""!==w(this).val()&&(n.find(".tc-option-image").eq(e).addClass("has-image"),n.find(".tc-option-image").eq(e).closest(".tc-upload-image-wrap").addClass("has-image")),n.find(".tm_upload_image").not(".tm_upload_imagec, .tm_upload_imagep, .tm_upload_imagel").eq(e).find(".tm_upload_image_img").attr("src",w(this).val()||O)}),n.find(".tc-option-imagec").each(function(e){""!==w(this).val()&&(n.find(".tc-option-imagec").eq(e).addClass("has-image"),n.find(".tc-option-imagec").eq(e).closest(".tc-upload-image-wrap").addClass("has-image")),n.find(".tm_upload_imagec").eq(e).find(".tm_upload_image_img").attr("src",w(this).val()||O)}),n.find(".tc-option-imagep").each(function(e){""!==w(this).val()&&(n.find(".tc-option-imagep").eq(e).addClass("has-image"),n.find(".tc-option-imagep").eq(e).closest(".tc-upload-image-wrap").addClass("has-image")),n.find(".tm_upload_imagep").eq(e).find(".tm_upload_image_img").attr("src",w(this).val()||O)}),n.find(".tc-option-imagel").each(function(e){""!==w(this).val()&&(n.find(".tc-option-imagel").eq(e).addClass("has-image"),n.find(".tc-option-imagel").eq(e).closest(".tc-upload-image-wrap").addClass("has-image")),n.find(".tm_upload_imagel").eq(e).find(".tm_upload_image_img").attr("src",w(this).val()||O)})},tm_weekdays:function(e){e=w(e||"body");e.find(".tm-weekdays").each(function(e,t){var i=w(t).val().split(","),t=w(t).next(".tm-weekdays-picker-wrap");w(t).find(".tm-weekday-picker").each(function(e,t){-1!==i.indexOf(w(t).val())?(w(t).attr("checked","checked").prop("checked",!0),w(t).closest(".tm-weekdays-picker").addClass("tm-checked")):(w(t).prop("checked",!1),w(t).closest(".tm-weekdays-picker").removeClass("tm-checked"))})})},tm_weekday_picker:function(){var e=w(this).closest(".tm-weekdays-picker-wrap").prev(".tm-weekdays"),t=w(e).val().split(","),i=t.indexOf(w(this).val());w(this).is(":checked")?-1===i&&t.push(w(this).val()):-1!==i&&t.splice(i,1),t=w.map(t,function(e){return""===e?null:e}),w(e).val(t.join(",")),w.tmEPOAdmin.tm_weekdays(w(e).parent())},tm_months:function(e){e=w(e||"body");e.find(".tm-months").each(function(e,t){var i=w(t).val().split(","),t=w(t).next(".tm-months-picker-wrap");w(t).find(".tm-month-picker").each(function(e,t){-1!==i.indexOf(w(t).val())?(w(t).attr("checked","checked").prop("checked",!0),w(t).closest(".tm-months-picker").addClass("tm-checked")):(w(t).prop("checked",!1),w(t).closest(".tm-months-picker").removeClass("tm-checked"))})})},tm_month_picker:function(){var e=w(this).closest(".tm-months-picker-wrap").prev(".tm-months"),t=w(e).val().split(","),i=t.indexOf(w(this).val());w(this).is(":checked")?-1===i&&t.push(w(this).val()):-1!==i&&t.splice(i,1),t=w.map(t,function(e){return""===e?null:e}),w(e).val(t.join(",")),w.tmEPOAdmin.tm_months(w(e).parent())},tm_pricetype_selector:function(e){var t=w(".tc-element-setting-price, .tc-element-setting-sale-price"),e=w(e?this:"#tc-floatbox-content .tm-pricetype-selector");"math"===e.val()?t.attr("autocomplete","off"):t.removeAttr("autocomplete")},dynamicMode:function(e){var t=w(".tc-element-setting-price"),e=w(e?this:"#tc-floatbox-content .dynamic-mode"),e=e.val();t.removeClass("dynamic-product-price override-product-price change-product-weight"),"dynamic_product_price"===e?t.addClass("dynamic-product-price"):"override_product_price"===e?t.addClass("override-product-price"):"change_product_weight"===e&&t.addClass("change-product-weight")},tm_option_price_type:function(e){e=w(e?this:"#tc-floatbox-content .tm_option_price_type");"math"===e.val()?w(".tm_option_price, .tm_option_sale_price").attr("autocomplete","off"):w(".tm_option_price, .tm_option_sale_price").removeAttr("autocomplete")},tm_url:function(e){var t=w("#tc-floatbox-content"),i=w(this),t=t.find(".builder-element-wrap").find(".tc-cell-url");"url"===(i=e?i:w("#tc-floatbox-content .use_url")).val()?t.show():t.hide()},upload:function(e){var o,d,s,n,t;if(e.preventDefault(),!_||!_.media)return!1;o=w(this).prev("input"),d=w(this).nextAll(".tm_upload_image").first().find("img"),(o.data("tm_upload_frame")?o.data("tm_upload_frame"):(e=_.media.controller.Library.extend({defaults:b.defaults({id:"insert-image",title:"Insert Image Url",allowLocalEdits:!0,displaySettings:!0,displayUserSettings:!0,multiple:!0,type:"image"},_.media.controller.Library.prototype.defaults)}),(s=_.media({button:{text:"Select"},state:"insert-image",states:[new e]})).on("select",function(){var l=s.state("insert-image"),e=l.get("selection");e&&(d.attr("src",""),o.val(""),e.each(function(e){var i,n=l.display(e).toJSON(),t=e.toJSON(),a=t.caption;_.media.view.settings.captions||delete t.caption,n=_.media.string.props(n,t),i={id:t.id,post_content:t.description,post_excerpt:a},n.linkUrl&&(i.url=n.linkUrl),"image"===t.type?(b.each({align:"align",size:"image-size",alt:"image_alt"},function(e,t){n[t]&&(i[e]=n[t])}),i["image-size"]&&e.attributes.sizes[i["image-size"]]&&(i.url=e.attributes.sizes[i["image-size"]].url)):i.post_title=n.title,d.attr("src",i.url),o.val(i.url),o.addClass("has-image"),o.closest(".tc-upload-image-wrap").addClass("has-image")}),w(c).off("ajaxSuccess.tcadminupload"))}),t=function(){w(".attachment-info").after(w(".attachment-display-settings"))},n=function(){var e=s.state().get("library").toJSON(),a=!0;w.each(e,function(e,i){var n;i.url===o.val()?(n=_.media.attachment(i.id),s.state().get("selection").add(n?[n]:[]),w(".attachment-display-settings").find("select.size").val("full"),a=!1):i.sizes&&w.each(i.sizes,function(e,t){t.url===o.val()&&(n=_.media.attachment(i.id),s.state().get("selection").add(n?[n]:[]),w(".attachment-display-settings").find("select.size").val(e),a=!1)}),a&&w(".attachment-display-settings").find("select.size").val("full")}),t()},s.on("selection:toggle",function(){w(".attachment-display-settings").find("select.size").val("full"),t()}),s.on("close",function(){w(c).off("ajaxSuccess.tcadminupload")}),w(c).off("ajaxSuccess.tcadminupload").on("ajaxSuccess.tcadminupload",function(e,t,i){"query-attachments"===w.epoAPI.util.parseParams(i.data).action&&setTimeout(function(){n()},500)}),s.on("open",function(){n()}),o.data("tm_upload_frame",s),s)).open()},populatePriceVariables:function(e,t,i){var n,a,l=w.epoAPI.util.deepCopyArray(y.map(function(e,n){return e.fields.map(function(e,t){var i=e.find(function(e){return"element_type"===e.id});return i.default&&(i=i.default),e=(e=e.filter(function(e){return null!==e}).find(function(e){return e.id===i+"_uniqid"}))&&e.default,{sectionIndex:n,fieldIndex:t,uniqid:e,type:i}})})),o=w(".tm-element-uniqid").attr("data-uniqid"),d=w('<h4 class="tc-var-header">'+x.i18n_formula_product_variables+"</h4>");e.append(d),d=w('<ul class="tc-var-list product"></ul>'),e.append(d),d.append('<li class="tc-var-field" data-value="{quantity}"><span>'+x.i18n_formula_quantity+"</span></li>"),d.append('<li class="tc-var-field" data-value="{product_price}"><span>'+x.i18n_formula_product_price+"</span></li>"),t||i||d.append('<li class="tc-var-field" data-value="{dynamic_product_price}"><span>'+x.i18n_formula_dynamic_product_price+"</span></li>"),t||(d=w('<h4 class="tc-var-header">'+x.i18n_formula_special_variables+"</h4>"),e.append(d),d=w('<ul class="tc-var-list product"></ul>'),e.append(d),d.append('<li class="tc-var-field" data-value="{options_total}"><span>'+x.i18n_formula_options_total+"</span></li>"),d.append('<li class="tc-var-field" data-value="{product_price_plus_options_total}"><span>'+x.i18n_formula_product_price_plus_options_total+"</span></li>"),d.append('<li class="tc-var-field" data-value="{cumulative_total}"><span>'+x.i18n_formula_cumulative_total+"</span></li>"),d.append('<li class="tc-var-field" data-value="{product_price_plus_cumulative_total}"><span>'+x.i18n_product_price_plus_cumulative_total+"</span></li>")),t||i||(d=w('<h4 class="tc-var-header">'+x.i18n_formula_this_element+"</h4>"),e.append(d),d=w('<ul class="tc-var-list this"></ul>'),e.append(d),d.append('<li class="tc-var-field" data-value="{this.value}"><span>'+x.i18n_formula_this_value+"</span></li>"),d.append('<li class="tc-var-field" data-value="{this.value.length}"><span>'+x.i18n_formula_this_value_length+"</span></li>"),d.append('<li class="tc-var-field" data-value="{this.count}"><span>'+x.i18n_formula_this_count+"</span></li>"),d.append('<li class="tc-var-field" data-value="{this.count.quantity}"><span>'+x.i18n_formula_this_count_quantity+"</span></li>"),d.append('<li class="tc-var-field" data-value="{this.quantity}"><span>'+x.i18n_formula_this_quantity+"</span></li>")),l.length&&(d=w('<h4 class="tc-var-header">'+x.i18n_formula_other_elements+"</h4>"),e.append(d),d=w('<div class="tc-clearfix tm-epo-switch-wrapper"><div class="formula-field-mode-selector"><input checked="checked" name="formulamode" class="formula-field-mode" id="formulafieldmode0" value="price" type="radio"><label for="formulafieldmode0"><span title="'+x.i18n_formula_field_price_tip+'" class="tm-tooltip tc-radio-text">'+x.i18n_formula_field_price+'</span></label><input name="formulamode" class="formula-field-mode" id="formulafieldmode1" value="value" type="radio"><label for="formulafieldmode1"><span title="'+x.i18n_formula_field_value_tip+'" class="tm-tooltip tc-radio-text">'+x.i18n_formula_field_value+'</span></label><input name="formulamode" class="formula-field-mode" id="formulafieldmode4" value="text" type="radio"><label for="formulafieldmode4"><span title="'+x.i18n_formula_field_text_tip+'" class="tm-tooltip tc-radio-text">'+x.i18n_formula_field_text+'</span></label><input name="formulamode" class="formula-field-mode" id="formulafieldmode5" value="text.length" type="radio"><label for="formulafieldmode5"><span title="'+x.i18n_formula_field_text_length_tip+'" class="tm-tooltip tc-radio-text">'+x.i18n_formula_field_text_length+'</span></label><input name="formulamode" class="formula-field-mode" id="formulafieldmode2"  value="quantity" type="radio"><label for="formulafieldmode2"><span title="'+x.i18n_formula_field_quantity_tip+'" class="tm-tooltip tc-radio-text">'+x.i18n_formula_field_quantity+'</span></label><input name="formulamode" class="formula-field-mode" id="formulafieldmode3" value="count" type="radio"><label for="formulafieldmode3"><span title="'+x.i18n_formula_field_count_tip+'" class="tm-tooltip tc-radio-text">'+x.i18n_formula_field_count+"</span></label></div></div>"),e.append(d),d=w('<ul class="tc-var-list other"></ul>'),e.append(d),l.forEach(function(e){e.forEach(function(e){e.uniqid!==o&&void 0!==e.uniqid&&(n=w.tmEPOAdmin.getFieldValue(y[e.sectionIndex].fields[e.fieldIndex],"internal_name",e.type),a=w.tmEPOAdmin.getFieldValue(y[e.sectionIndex].fields[e.fieldIndex],"header_title",e.type),"product"!==e.type)&&"dynamic"!==e.type&&(n=n+(a=""!==(a=void 0===a?"":a)?" ("+a+")":a),d.append('<li title="'+e.uniqid+'" class="tc-var-field" data-value="{field.'+e.uniqid+'.price}"><span>'+n+"</span></li>"))})})),w.tcToolTip(e.find(".tm-tooltip"))}},Array.apply(null,Array(100)).forEach(function(e,t){w.tmEPOAdmin.builderSize["w"+(t+1)]=t+1+"%",11===t&&(w.tmEPOAdmin.builderSize["w12-5"]="12.5%"),32===t&&(w.tmEPOAdmin.builderSize["w33-3"]="33.3%"),36===t&&(w.tmEPOAdmin.builderSize["w37-5"]="37.5%"),61===t&&(w.tmEPOAdmin.builderSize["w62-5"]="62.5%"),86===t&&(w.tmEPOAdmin.builderSize["w87-5"]="87.5%")}),w(function(){g=w.epoAPI.applyFilter("tc_adjust_admin_template_engine",g),a=r.woocommerce_admin,m=r.tinyMCEPreInit,u=r.QTags,p=r.quicktags,f=r.tinyMCE,e=r.TMEPOOPTIONSJS.data,n=r.wc_enhanced_select_params,void 0!==(y=w.epoAPI.util.deepCopyArray(e))&&y||(y=[]),w.tmEPOAdmin.initialitize(),w.tcToolTip(),l&&w(".tc-admin-extra-product-options_tab").on("click.cpf",function(){w.tmEPOAdmin.makeResizables(w(".builder-wrapper")),w.tmEPOAdmin.makeResizables(w(".bitem")),w(this).off("click.cpf")})})}(window,document,window.jQuery);